/**
 * 2022 개정 교육과정 기반 수학 단원별 학습 전략
 *
 * 분석된 토픽(단원)에 매칭되는 구체적인 학습 가이드를 제공합니다.
 */

export interface TopicStrategy {
  keywords: string[];  // 토픽 매칭 키워드
  strategies: string[];  // 학습 전략 (최대 4개)
  tags?: string[];  // 문제 유형 태그
}

export interface GradeUnit {
  name: string;
  topics: TopicStrategy[];
}

export interface GradeCurriculum {
  grade: string;
  semester: string;
  units: GradeUnit[];
}

// 중학교 교육과정
export const MIDDLE_SCHOOL_CURRICULUM: GradeCurriculum[] = [
  // 중1-1
  {
    grade: '중1',
    semester: '1학기',
    units: [
      {
        name: '수와 연산',
        topics: [
          {
            keywords: ['소인수분해', '약수', '배수', '최대공약수', '최소공배수'],
            strategies: [
              '거듭제곱으로 표현된 수의 약수 개수 구하는 공식(지수+1들의 곱) 원리 이해하기',
              '최대공약수(나누어 떨어지게 하는 수)와 최소공배수(다시 만나는 시점) 활용 키워드 구분',
              '소인수분해를 이용한 약수 구하기 연습',
            ],
            tags: ['계산', '개념'],
          },
          {
            keywords: ['정수', '유리수', '절댓값', '수직선'],
            strategies: [
              '수직선을 그려 절댓값의 거리 개념을 시각적으로 익히기',
              '덧셈, 뺄셈, 곱셈, 나눗셈 혼합 계산에서 부호 결정(+, -) 순서 지키기',
              '음수 계산 시 부호 실수를 줄이기 위해 괄호 사용 습관화',
            ],
            tags: ['연산', '부호'],
          },
        ],
      },
      {
        name: '문자와 식',
        topics: [
          {
            keywords: ['문자', '식', '대입', '다항식'],
            strategies: [
              '곱셈 기호 생략 규칙과 나눗셈의 분수 표현 익숙해지기',
              '문자에 음수를 대입할 때는 반드시 괄호를 사용하는 습관 들이기',
              '동류항끼리 묶어 계산하는 연습',
            ],
            tags: ['대입', '식세우기'],
          },
          {
            keywords: ['일차방정식', '이항', '등식'],
            strategies: [
              '이항할 때 부호가 바뀌는 원리(등식의 성질)를 말로 설명해보기',
              '거속시, 농도 등 활용 문제에서 미지수 x를 정하고 표를 그려 식 세우는 연습',
              '양변에 같은 수를 더하거나 곱하는 등식의 성질 활용',
            ],
            tags: ['이항', '활용'],
          },
        ],
      },
      {
        name: '좌표평면과 그래프',
        topics: [
          {
            keywords: ['좌표', '좌표평면', '사분면', '그래프'],
            strategies: [
              'x축 위의 점(y=0), y축 위의 점(x=0) 좌표 특징 암기',
              '사분면별 (+,+), (-,+) 등의 부호 체계 파악',
              '점의 위치를 빠르게 찾는 연습',
            ],
            tags: ['그래프', '해석'],
          },
          {
            keywords: ['정비례', '반비례', '비례'],
            strategies: [
              '정비례(y=ax)는 원점을 지나는 직선, 반비례(y=a/x)는 곡선임을 그리기',
              'a의 절댓값 크기에 따라 그래프가 축에 가까워지는지 멀어지는지 비교',
              '비례 상수 a의 부호에 따른 그래프 방향 이해',
            ],
            tags: ['함수기초', '비례'],
          },
        ],
      },
    ],
  },
  // 중1-2
  {
    grade: '중1',
    semester: '2학기',
    units: [
      {
        name: '기본 도형',
        topics: [
          {
            keywords: ['평행', '수직', '동위각', '엇각', '꼬인 위치'],
            strategies: [
              '평행선에서 동위각과 엇각의 크기가 같음을 이용해 각도 구하기',
              '꼬인 위치(만나지도, 평행하지도 않음)를 입체도형 겨냥도에서 찾기',
              '다양한 각도 문제로 평행선 성질 활용 연습',
            ],
            tags: ['도형', '위치관계'],
          },
          {
            keywords: ['작도', '합동', 'SSS', 'SAS', 'ASA'],
            strategies: [
              '컴퍼스와 눈금 없는 자의 용도를 명확히 구분하기',
              '삼각형 합동 조건(SSS, SAS, ASA)을 문제 상황에 맞춰 찾아내기',
              '합동인 도형의 대응 요소 찾는 연습',
            ],
            tags: ['작도', '증명'],
          },
        ],
      },
      {
        name: '평면도형',
        topics: [
          {
            keywords: ['다각형', '내각', '외각', '대각선'],
            strategies: [
              'n각형의 내각의 합(180 × (n-2))과 대각선 개수 공식 유도해보기',
              '정다각형의 한 내각, 한 외각 구하는 공식 암기',
              '대각선의 개수 n(n-3)/2 공식 활용',
            ],
            tags: ['공식', '계산'],
          },
          {
            keywords: ['부채꼴', '호', '중심각', '원'],
            strategies: [
              '부채꼴의 넓이와 호의 길이는 중심각의 크기에 정비례함 이용',
              '원의 넓이와 둘레 공식 숙지',
              '부채꼴 공식: 넓이 = (1/2)lr, 호의 길이 = 2πr × (중심각/360)',
            ],
            tags: ['공식', '계산'],
          },
        ],
      },
      {
        name: '입체도형',
        topics: [
          {
            keywords: ['다면체', '회전체', '기둥', '뿔', '구'],
            strategies: [
              '다면체의 면, 모서리, 꼭짓점 개수 세기 (오일러 공식: V-E+F=2)',
              '회전체를 그릴 때 회전축을 기준으로 선대칭이 됨을 이해',
              '각 입체도형의 전개도 그리기 연습',
            ],
            tags: ['공간', '측정'],
          },
        ],
      },
      {
        name: '통계',
        topics: [
          {
            keywords: ['도수분포', '히스토그램', '상대도수', '줄기와 잎'],
            strategies: [
              '줄기와 잎 그림에서 중복되는 자료 빠짐없이 세기',
              '히스토그램의 직사각형 넓이 합과 도수분포다각형 넓이 관계 이해',
              '상대도수의 합은 항상 1임을 이용',
            ],
            tags: ['분석', '계산'],
          },
        ],
      },
    ],
  },
  // 중2-1
  {
    grade: '중2',
    semester: '1학기',
    units: [
      {
        name: '수와 연산',
        topics: [
          {
            keywords: ['유리수', '순환소수', '유한소수'],
            strategies: [
              '분모를 소인수분해했을 때 2나 5뿐이면 유한소수임을 판별',
              '순환소수를 분수로 바꿀 때 "순환마디 개수만큼 9" 공식 숙달',
              '기약분수로 만들어 유한/순환 판별하기',
            ],
            tags: ['분수변환', '조건'],
          },
        ],
      },
      {
        name: '식의 계산',
        topics: [
          {
            keywords: ['지수', '단항식', '다항식', '곱셈', '나눗셈'],
            strategies: [
              '지수법칙(합, 차, 곱) 헷갈리지 않도록 기본 연산 반복 훈련',
              '다항식의 덧셈/뺄셈에서 동류항끼리 묶어 계산 실수 줄이기',
              '단항식의 곱셈/나눗셈에서 계수와 문자 따로 계산',
            ],
            tags: ['지수법칙', '전개'],
          },
        ],
      },
      {
        name: '부등식',
        topics: [
          {
            keywords: ['일차부등식', '부등호', '해집합'],
            strategies: [
              '음수를 곱하거나 나눌 때 "부등호 방향"이 바뀜을 항상 체크',
              '"작지 않다(이상)", "크지 않다(이하)" 등의 표현을 부등호로 변환 연습',
              '수직선 위에 해집합 표시하기',
            ],
            tags: ['부호', '범위'],
          },
        ],
      },
      {
        name: '연립방정식',
        topics: [
          {
            keywords: ['연립방정식', '가감법', '대입법'],
            strategies: [
              '가감법과 대입법 중 계수를 맞추기 편한 방법 선택 훈련',
              '해가 특수한 경우(해가 무수히 많다/없다)의 계수 비율 확인',
              '미지수가 3개인 연립방정식도 같은 원리로 풀이',
            ],
            tags: ['소거', '대입'],
          },
        ],
      },
      {
        name: '일차함수',
        topics: [
          {
            keywords: ['일차함수', '기울기', '절편', 'y=ax+b'],
            strategies: [
              'x절편(y=0일 때)과 y절편(x=0일 때) 구하여 그래프 빠르게 그리기',
              '기울기(y증가량/x증가량)의 의미를 그래프 상에서 이해',
              '두 점을 지나는 직선의 방정식 구하기',
            ],
            tags: ['기울기', '절편'],
          },
        ],
      },
    ],
  },
  // 중2-2
  {
    grade: '중2',
    semester: '2학기',
    units: [
      {
        name: '삼각형의 성질',
        topics: [
          {
            keywords: ['이등변삼각형', '직각삼각형', '외심', '내심'],
            strategies: [
              '이등변삼각형의 꼭지각의 이등분선이 밑변을 수직이등분함 기억',
              '외심(변의 수직이등분선 교점)과 내심(각의 이등분선 교점) 정의 구분',
              '외심에서 세 꼭짓점까지 거리가 같음을 활용',
            ],
            tags: ['증명', '성질'],
          },
        ],
      },
      {
        name: '사각형의 성질',
        topics: [
          {
            keywords: ['평행사변형', '직사각형', '마름모', '정사각형', '등변사다리꼴'],
            strategies: [
              '평행사변형이 되기 위한 5가지 조건 암기 및 적용',
              '여러 가지 사각형 사이의 포함 관계(족보)를 벤 다이어그램으로 이해',
              '각 사각형의 대각선 성질 비교 정리',
            ],
            tags: ['포함관계', '조건'],
          },
        ],
      },
      {
        name: '도형의 닮음',
        topics: [
          {
            keywords: ['닮음', '닮음비', 'AA', 'SAS', 'SSS', '축소', '확대'],
            strategies: [
              'AA 닮음, SAS 닮음 조건을 찾고 대응변의 길이 비 세우기',
              '닮음비가 a:b이면 넓이비는 a²:b², 부피비는 a³:b³',
              '삼각형의 중점연결정리 활용',
            ],
            tags: ['비례식', '응용'],
          },
          {
            keywords: ['무게중심', '중선', '삼각형의 중심'],
            strategies: [
              '무게중심이 중선을 2:1로 내분함을 이용하여 길이 구하기',
              '무게중심의 좌표 = 세 꼭짓점 좌표의 평균',
              '중선의 성질 활용 문제 연습',
            ],
            tags: ['중심', '비례'],
          },
        ],
      },
      {
        name: '피타고라스 정리',
        topics: [
          {
            keywords: ['피타고라스', '직각삼각형', '빗변'],
            strategies: [
              '직각삼각형에서 빗변의 제곱은 나머지 두 변의 제곱 합과 같음',
              '피타고라스의 수(3-4-5, 5-12-13 등) 암기하여 계산 속도 높이기',
              '평면도형에서 높이나 대각선 구할 때 직각삼각형 찾기',
            ],
            tags: ['공식', '계산'],
          },
        ],
      },
      {
        name: '확률',
        topics: [
          {
            keywords: ['확률', '경우의 수', '사건'],
            strategies: [
              '사건 A 또는 B(합), A와 B 동시에(곱) 구분하여 계산',
              '전체 확률 1에서 일어나지 않을 확률을 빼는 "여사건" 활용',
              '수형도나 표를 이용해 경우의 수 빠짐없이 세기',
            ],
            tags: ['경우의수', '논리'],
          },
        ],
      },
    ],
  },
  // 중3-1
  {
    grade: '중3',
    semester: '1학기',
    units: [
      {
        name: '실수',
        topics: [
          {
            keywords: ['제곱근', '근호', '무리수', '실수'],
            strategies: [
              '제곱근의 성질을 이용하여 문자의 부호에 따라 식 간단히 하기',
              '√a² = |a| 임을 활용하여 절댓값 처리',
              '무리수와 유리수의 구분 명확히 하기',
            ],
            tags: ['제곱근', '유리화'],
          },
          {
            keywords: ['분모의 유리화', '유리화'],
            strategies: [
              '분모에 무리수가 있을 때 합차공식을 이용해 유리화하는 훈련',
              '√a × √b = √(ab) 공식 활용',
              '분모가 a+√b 형태일 때 켤레근 곱하기',
            ],
            tags: ['유리화', '계산'],
          },
        ],
      },
      {
        name: '인수분해',
        topics: [
          {
            keywords: ['인수분해', '곱셈공식', '완전제곱식', '합차공식'],
            strategies: [
              '곱셈 공식 변형을 능숙하게 사용',
              '공통인수 묶기, 완전제곱식, 합차공식 순서로 인수분해 전략 수립',
              '복잡한 식은 치환하여 간단히 만들기',
            ],
            tags: ['공식', '변형'],
          },
        ],
      },
      {
        name: '이차방정식',
        topics: [
          {
            keywords: ['이차방정식', '근의 공식', '판별식', '중근'],
            strategies: [
              '인수분해가 안 될 때는 근의 공식 사용, 짝수 공식 암기 필수',
              '중근을 가질 조건(완전제곱식, D=0) 활용 문제 풀이',
              '근과 계수의 관계: 두 근의 합 = -b/a, 곱 = c/a',
            ],
            tags: ['근의공식', '판별'],
          },
        ],
      },
      {
        name: '이차함수',
        topics: [
          {
            keywords: ['이차함수', '포물선', '꼭짓점', '축'],
            strategies: [
              '일반형을 표준형으로 고쳐 꼭짓점과 축의 방정식 찾기',
              'a의 부호(볼록 방향)와 c(y절편)의 위치로 그래프 개형 추론',
              '이차함수의 최댓값/최솟값은 꼭짓점에서 결정됨',
            ],
            tags: ['표준형', '그래프'],
          },
        ],
      },
    ],
  },
  // 중3-2
  {
    grade: '중3',
    semester: '2학기',
    units: [
      {
        name: '삼각비',
        topics: [
          {
            keywords: ['삼각비', 'sin', 'cos', 'tan', '사인', '코사인', '탄젠트'],
            strategies: [
              '30도, 45도, 60도의 sin, cos, tan 값 표 완벽 암기',
              '직각삼각형이 보이지 않을 때 수선을 그어 직각삼각형 만드는 보조선 훈련',
              'sin²θ + cos²θ = 1 항등식 활용',
            ],
            tags: ['특수각', '활용'],
          },
        ],
      },
      {
        name: '원의 성질',
        topics: [
          {
            keywords: ['원주각', '중심각', '접선', '현', '할선'],
            strategies: [
              '같은 호에 대한 원주각의 크기는 같고, 중심각의 절반임을 이용',
              '원 밖의 한 점에서 원에 그은 두 접선의 길이는 같음',
              '접선과 현이 이루는 각 = 그 호에 대한 원주각',
            ],
            tags: ['원주각', '접선'],
          },
        ],
      },
      {
        name: '통계',
        topics: [
          {
            keywords: ['대푯값', '산포도', '분산', '표준편차', '상관관계'],
            strategies: [
              '편차의 총합은 항상 0임을 이용하여 모르는 변량 구하기',
              '산점도를 보고 양의 상관관계, 음의 상관관계, 관계없음 판별',
              '분산 = 편차²의 평균, 표준편차 = √분산',
            ],
            tags: ['편차', '상관관계'],
          },
        ],
      },
    ],
  },
];

// 고등학교 교육과정
export const HIGH_SCHOOL_CURRICULUM: GradeCurriculum[] = [
  // 공통수학 1 (고1-1)
  {
    grade: '고1',
    semester: '1학기',
    units: [
      {
        name: '다항식',
        topics: [
          {
            keywords: ['다항식', '곱셈', '전개', '치환'],
            strategies: [
              '복잡한 식을 치환하여 전개하거나 공통부분 찾기',
              '곱셈공식 활용하여 빠르게 전개',
              '식의 구조를 파악하여 효율적으로 계산',
            ],
            tags: ['곱셈공식', '전개'],
          },
          {
            keywords: ['나머지정리', '인수정리', '항등식'],
            strategies: [
              'P(x)를 (x-a)로 나눈 나머지는 P(a)임을 직관적으로 활용',
              '조립제법을 이용해 3차 이상의 식을 인수분해하는 과정 숙달',
              '인수정리로 인수 찾기: P(a)=0이면 (x-a)가 인수',
            ],
            tags: ['항등식', '수치대입'],
          },
          {
            keywords: ['인수분해', '고차식', '복이차식'],
            strategies: [
              '인수정리를 이용해 식의 값이 0이 되는 x(약수 대입) 찾기',
              '복이차식은 치환으로 이차식으로 변형',
              '공통인수 → 공식 적용 순서로 인수분해',
            ],
            tags: ['고차식', '복이차식'],
          },
        ],
      },
      {
        name: '방정식',
        topics: [
          {
            keywords: ['복소수', '허수', '켤레복소수', '허수단위'],
            strategies: [
              'i의 거듭제곱(i, -1, -i, 1)이 4개 단위로 반복됨을 이용',
              '켤레복소수의 성질과 사칙연산 실수화 연습',
              '복소수의 상등조건: 실수부와 허수부가 각각 같다',
            ],
            tags: ['허수', '주기성'],
          },
          {
            keywords: ['이차방정식', '근과 계수', '판별식'],
            strategies: [
              '두 근의 합과 곱을 이용해 이차방정식 작성하기',
              '판별식 D = b² - 4ac로 근의 개수 판별',
              '허근을 가질 조건: D < 0',
            ],
            tags: ['근과계수', '판별식'],
          },
          {
            keywords: ['이차함수', '교점', '위치관계'],
            strategies: [
              '판별식 D의 부호에 따른 x축과의 교점 개수 그래프 매칭',
              '이차함수와 직선의 위치관계 분석',
              '두 그래프의 교점은 연립방정식의 해',
            ],
            tags: ['교점', '위치관계'],
          },
          {
            keywords: ['삼차방정식', '사차방정식', '고차방정식'],
            strategies: [
              '삼차방정식은 반드시 하나 이상의 실근(인수분해)을 가짐을 이용',
              '사차방정식은 복이차식 또는 인수분해로 접근',
              '조립제법으로 차수 낮추기',
            ],
            tags: ['고차방정식', '연립'],
          },
        ],
      },
      {
        name: '부등식',
        topics: [
          {
            keywords: ['이차부등식', '연립부등식'],
            strategies: [
              '이차함수 그래프와 x축의 위치관계로 해집합 구하기',
              '연립부등식은 각 부등식의 해집합의 교집합',
              '절댓값 부등식은 경우를 나누어 풀기',
            ],
            tags: ['범위', '해집합'],
          },
        ],
      },
      {
        name: '경우의 수',
        topics: [
          {
            keywords: ['경우의 수', '합의 법칙', '곱의 법칙'],
            strategies: [
              '빠짐없이 세기 위해 사전식 배열이나 수형도 그리기 연습',
              '동시에 일어나는 경우(곱), 배타적 경우(합) 구분',
              '여사건 활용: 전체 - 안 되는 경우',
            ],
            tags: ['합/곱', '수형도'],
          },
          {
            keywords: ['순열', '조합', 'P', 'C', 'nPr', 'nCr'],
            strategies: [
              '순서가 중요하면 순열(P), 뽑기만 하면 조합(C) 구분 훈련',
              'nCr = nCn-r 성질 활용',
              '중복순열, 원순열 공식 숙지',
            ],
            tags: ['순서', '선택'],
          },
        ],
      },
      {
        name: '행렬',
        topics: [
          {
            keywords: ['행렬', '역행렬', '행렬식'],
            strategies: [
              '행렬의 곱셈은 교환법칙이 성립하지 않음(AB ≠ BA) 주의',
              '2x2 행렬의 역행렬 존재 조건(ad-bc ≠ 0) 암기',
              '역행렬을 이용한 연립방정식 풀이',
            ],
            tags: ['연산', '역행렬'],
          },
        ],
      },
    ],
  },
  // 공통수학 2 (고1-2)
  {
    grade: '고1',
    semester: '2학기',
    units: [
      {
        name: '도형의 방정식',
        topics: [
          {
            keywords: ['평면좌표', '거리', '내분', '외분'],
            strategies: [
              '두 점 사이의 거리 공식과 내분점/외분점 공식 혼동 주의',
              '내분점: m:n으로 나누는 점의 좌표 공식',
              '삼각형의 무게중심 좌표 = 세 꼭짓점 좌표의 평균',
            ],
            tags: ['거리', '분점'],
          },
          {
            keywords: ['직선의 방정식', '기울기', '수직', '평행'],
            strategies: [
              '두 직선의 수직 조건(기울기 곱 = -1) 활용 빈도 높음',
              '점과 직선 사이의 거리 공식 d 활용 연습',
              '직선의 방정식: y-y₁ = m(x-x₁)',
            ],
            tags: ['기울기', '정점'],
          },
          {
            keywords: ['원의 방정식', '중심', '반지름'],
            strategies: [
              '일반형을 표준형으로 바꿔 중심 (a,b)와 반지름 r 찾기',
              '원과 직선의 위치관계: 중심과 직선 사이 거리 vs 반지름',
              '두 원의 교점을 지나는 직선의 방정식 구하기',
            ],
            tags: ['중심', '반지름'],
          },
          {
            keywords: ['대칭', '평행이동', '도형의 이동'],
            strategies: [
              '점의 이동과 도형의 방정식 이동(부호 반대 대입) 차이점 구분',
              'x축 대칭: (x,y) → (x,-y), y축 대칭: (x,y) → (-x,y)',
              '원점 대칭: (x,y) → (-x,-y)',
            ],
            tags: ['평행', '대칭'],
          },
        ],
      },
      {
        name: '집합과 명제',
        topics: [
          {
            keywords: ['집합', '부분집합', '교집합', '합집합', '차집합', '여집합'],
            strategies: [
              '드모르간의 법칙과 차집합 성질 자유롭게 변환',
              '부분집합의 개수: 원소가 n개이면 2ⁿ개',
              '벤 다이어그램으로 집합 관계 시각화',
            ],
            tags: ['연산', '포함'],
          },
          {
            keywords: ['명제', '역', '이', '대우', '필요조건', '충분조건'],
            strategies: [
              'p → q가 참이면 대우 ~q → ~p도 참임을 이용',
              '필요조건과 충분조건 구분: p → q가 참이면 p는 충분조건, q는 필요조건',
              '반례를 찾아 거짓 명제 증명',
            ],
            tags: ['참거짓', '증명'],
          },
          {
            keywords: ['산술평균', '기하평균', '절대부등식'],
            strategies: [
              '산술·기하 평균으로 최솟값 구하기: (a+b)/2 ≥ √(ab)',
              '등호 성립 조건(a=b일 때) 확인 필수',
              '코시-슈바르츠 부등식 활용',
            ],
            tags: ['부등식', '증명'],
          },
        ],
      },
      {
        name: '함수',
        topics: [
          {
            keywords: ['함수', '합성함수', '역함수'],
            strategies: [
              '역함수 구하는 순서(x, y 바꾸기 → y에 대해 정리) 숙달',
              '합성함수 (f∘g)(x) = f(g(x)) 계산 순서 주의',
              '역함수가 존재하려면 일대일대응이어야 함',
            ],
            tags: ['합성', '역함수'],
          },
          {
            keywords: ['유리함수', '무리함수', '점근선'],
            strategies: [
              '유리함수는 점근선의 교점, 무리함수는 시작점이 그래프의 핵심',
              '유리함수 y=k/(x-a)+b의 점근선: x=a, y=b',
              '무리함수 y=√(x-a)+b의 시작점: (a,b)',
            ],
            tags: ['점근선', '시작점'],
          },
        ],
      },
    ],
  },
  // 대수 (수학I)
  {
    grade: '고2',
    semester: '1학기',
    units: [
      {
        name: '지수와 로그',
        topics: [
          {
            keywords: ['지수', '로그', '지수법칙', '로그법칙'],
            strategies: [
              '로그 정의 조건(밑, 진수 조건) 문제 풀기 전 확인',
              '지수법칙과 로그법칙 공식 암기 필수',
              'log_a(xy) = log_a(x) + log_a(y) 활용',
            ],
            tags: ['성질', '계산'],
          },
          {
            keywords: ['지수함수', '로그함수'],
            strategies: [
              '지수함수와 로그함수는 y=x 대칭(역함수) 관계임을 이용',
              '밑이 1보다 크면 증가, 0<밑<1이면 감소',
              '그래프의 점근선과 지나는 점 파악',
            ],
            tags: ['그래프', '역함수'],
          },
        ],
      },
      {
        name: '삼각함수',
        topics: [
          {
            keywords: ['삼각함수', '호도법', '라디안', '단위원'],
            strategies: [
              '사인법칙(외접원 반지름 R)과 코사인법칙(변3, 각1) 사용 상황 구분',
              '삼각함수 그래프의 주기와 대칭성을 이용해 방정식 해의 합 구하기',
              '호도법: 180° = π 라디안',
            ],
            tags: ['단위원', '법칙'],
          },
          {
            keywords: ['삼각함수 그래프', '주기', '진폭'],
            strategies: [
              'y = asin(bx+c)+d에서 a는 진폭, 주기는 2π/|b|',
              '삼각함수의 덧셈정리 활용',
              '삼각방정식/부등식 풀이',
            ],
            tags: ['그래프', '주기'],
          },
        ],
      },
      {
        name: '수열',
        topics: [
          {
            keywords: ['등차수열', '등비수열', '일반항'],
            strategies: [
              '등차중항, 등비중항 성질을 이용해 미지수 빠르게 구하기',
              '등차수열 일반항: aₙ = a₁ + (n-1)d',
              '등비수열 일반항: aₙ = a₁ × rⁿ⁻¹',
            ],
            tags: ['일반항', '합'],
          },
          {
            keywords: ['시그마', '수열의 합', '부분분수'],
            strategies: [
              '시그마 공식 암기 및 부분분수 소거형 계산 연습',
              'Σk = n(n+1)/2, Σk² = n(n+1)(2n+1)/6',
              '수열의 합과 일반항 관계: aₙ = Sₙ - Sₙ₋₁',
            ],
            tags: ['시그마', '부분분수'],
          },
          {
            keywords: ['수학적 귀납법', '귀납적 정의'],
            strategies: [
              'n=1 성립, n=k 가정 후 n=k+1 유도 논리 구조 작성',
              '점화식을 이용한 귀납적 정의 이해',
              '귀납법 증명의 논리적 흐름 파악',
            ],
            tags: ['증명', '귀납적정의'],
          },
        ],
      },
    ],
  },
  // 미적분 I (수학II)
  {
    grade: '고2',
    semester: '2학기',
    units: [
      {
        name: '함수의 극한',
        topics: [
          {
            keywords: ['극한', '함수의 극한', '부정형'],
            strategies: [
              '0/0 꼴(약분/유리화), 무한대/무한대 꼴(최고차항 계수비) 계산 숙달',
              '좌극한과 우극한이 같아야 극한값이 존재',
              '로피탈 정리 활용 (미적분 II)',
            ],
            tags: ['부정형', '샌드위치'],
          },
          {
            keywords: ['연속', '불연속', '연속함수'],
            strategies: [
              '연속의 정의: 좌극한 = 우극한 = 함숫값 일치 확인',
              '불연속점의 종류: 제거 가능 불연속, 점프 불연속, 무한 불연속',
              '최대·최소 정리, 사잇값 정리 활용',
            ],
            tags: ['좌우극한', '그래프'],
          },
        ],
      },
      {
        name: '미분',
        topics: [
          {
            keywords: ['미분계수', '도함수', '미분계수와 도함수', '접선의 방정식'],
            strategies: [
              '미분가능하면 연속이다(역은 성립 안 함) 명제 이해',
              '접선의 방정식: y - f(a) = f\'(a)(x - a)',
              '미분의 정의: f\'(x) = lim(h→0) [f(x+h)-f(x)]/h',
            ],
            tags: ['기울기', '정의'],
          },
          {
            keywords: ['도함수의 활용', '극대', '극소', '극값', '최대', '최소', '증가 감소'],
            strategies: [
              '도함수 f\'(x)의 부호 변화를 통해 원함수 f(x)의 그래프 개형 그리기',
              '극값을 가지려면 f\'(x)=0이고 부호가 바뀌어야 함',
              '변곡점에서 f\'\'(x)=0이고 오목 방향이 바뀜',
            ],
            tags: ['접선', '극대극소'],
          },
          {
            keywords: ['속도와 가속도', '위치함수', '운동'],
            strategies: [
              '속도(v)는 위치를 미분, 가속도(a)는 속도를 미분',
              '위치 함수 s(t)에서 v(t) = s\'(t), a(t) = v\'(t)',
              '그래프에서 속도의 부호로 운동 방향 판단',
            ],
            tags: ['속도', '가속도'],
          },
        ],
      },
      {
        name: '적분',
        topics: [
          {
            keywords: ['부정적분', '원시함수', '역미분'],
            strategies: [
              '적분상수 C를 빠뜨리지 않는 습관',
              '∫xⁿ dx = xⁿ⁺¹/(n+1) + C (n≠-1)',
              '미분의 역연산임을 이해',
            ],
            tags: ['적분상수', '역연산'],
          },
          {
            keywords: ['정적분의 활용', '정적분 활용', '넓이와 적분'],
            strategies: [
              '곡선과 x축 사이의 넓이는 절댓값 정적분으로 구하기',
              '속도 v(t)의 정적분 = 위치 변화량, |v(t)|의 정적분 = 이동 거리',
              '두 곡선 사이 넓이: ∫ₐᵇ |f(x) - g(x)| dx',
              '회전체의 부피: π∫ₐᵇ [f(x)]² dx',
            ],
            tags: ['넓이', '부피', '활용'],
          },
          {
            keywords: ['정적분 계산', '정적분'],
            strategies: [
              '위끝, 아래끝이 같으면 0, 순서 바뀌면 부호 반대 성질 활용',
              '정적분과 급수의 관계 이해',
              '∫ₐᵇ f(x)dx = F(b) - F(a)',
            ],
            tags: ['계산', '성질'],
          },
        ],
      },
    ],
  },
  // 확률과 통계
  {
    grade: '고2',
    semester: '선택',
    units: [
      {
        name: '경우의 수',
        topics: [
          {
            keywords: ['중복순열', '중복조합', '원순열', '같은 것이 있는 순열'],
            strategies: [
              '원순열, 중복순열, 중복조합(H)의 상황 명확히 구별',
              '같은 것이 있는 순열: n!/(p!q!...)',
              '중복조합 nHr = n+r-1Cr',
            ],
            tags: ['중복', '이항정리'],
          },
          {
            keywords: ['이항정리', '이항계수'],
            strategies: [
              '이항정리 일반항을 이용하여 특정 항의 계수 구하기',
              '(a+b)ⁿ의 r번째 항: nCr × aⁿ⁻ʳ × bʳ',
              '이항계수의 성질: nCr = nCn-r',
            ],
            tags: ['이항정리', '계수'],
          },
        ],
      },
      {
        name: '확률',
        topics: [
          {
            keywords: ['확률', '덧셈정리', '여사건'],
            strategies: [
              '"적어도"라는 표현이 나오면 여사건 확률(1-P) 고려',
              '배반사건의 확률: P(A∪B) = P(A) + P(B)',
              '일반 덧셈정리: P(A∪B) = P(A) + P(B) - P(A∩B)',
            ],
            tags: ['덧셈정리', '여사건'],
          },
          {
            keywords: ['조건부확률', '독립', '종속'],
            strategies: [
              '조건부확률 P(B|A) 정의를 표나 벤 다이어그램으로 이해',
              '사건의 독립 조건(교집합 확률 = 확률의 곱) 확인',
              'P(B|A) = P(A∩B)/P(A)',
            ],
            tags: ['독립', '종속'],
          },
        ],
      },
      {
        name: '통계',
        topics: [
          {
            keywords: ['확률분포', '이산확률변수', '기댓값', '분산'],
            strategies: [
              '이산확률변수의 평균 E(X)과 분산 V(X) 계산 공식 숙달',
              'E(aX+b) = aE(X)+b, V(aX+b) = a²V(X)',
              '이항분포 B(n,p): E(X)=np, V(X)=npq',
            ],
            tags: ['이산', '정규'],
          },
          {
            keywords: ['정규분포', '표준정규분포', '표준화'],
            strategies: [
              '정규분포 곡선의 대칭성을 이해하고 표준화(Z)하여 확률 구하기',
              'Z = (X-μ)/σ로 표준화',
              '정규분포표 읽는 방법 숙지',
            ],
            tags: ['정규분포', '표준화'],
          },
          {
            keywords: ['표본', '표본평균', '신뢰구간', '추정'],
            strategies: [
              '모평균의 신뢰구간 공식 암기 및 표본 크기 n과의 관계 파악',
              '표본평균의 분포: E(X̄)=μ, V(X̄)=σ²/n',
              '신뢰도가 높아지면 신뢰구간이 넓어짐',
            ],
            tags: ['표본', '신뢰구간'],
          },
        ],
      },
    ],
  },
  // 미적분 II
  {
    grade: '고3',
    semester: '선택',
    units: [
      {
        name: '수열의 극한',
        topics: [
          {
            keywords: ['수열의 극한', '급수', '수렴', '발산'],
            strategies: [
              '등비수열의 수렴 조건(공비 r의 범위: |r|<1) 체크',
              '급수가 수렴하면 일반항의 극한은 0이다 (역은 성립 안 함)',
              '등비급수의 합: a/(1-r) (|r|<1일 때)',
            ],
            tags: ['등비수열', '급수'],
          },
        ],
      },
      {
        name: '미분법',
        topics: [
          {
            keywords: ['지수함수 미분', '로그함수 미분', '삼각함수 미분'],
            strategies: [
              '지수, 로그, 삼각함수의 극한과 미분 공식 완벽 암기',
              '(eˣ)\' = eˣ, (ln x)\' = 1/x',
              '(sin x)\' = cos x, (cos x)\' = -sin x',
            ],
            tags: ['초월함수', '공식'],
          },
          {
            keywords: ['합성함수', '매개변수', '음함수', '역함수 미분'],
            strategies: [
              '몫의 미분법, 합성함수 미분법(겉미분 속미분) 연습',
              '이계도함수를 이용해 변곡점과 오목/볼록 파악',
              '매개변수 미분: dy/dx = (dy/dt)/(dx/dt)',
            ],
            tags: ['합성함수', '변곡점'],
          },
        ],
      },
      {
        name: '적분법',
        topics: [
          {
            keywords: ['치환적분', '부분적분'],
            strategies: [
              '치환적분과 부분적분(로다삼지) 중 적절한 방법 선택 훈련',
              '부분적분: ∫u dv = uv - ∫v du',
              '치환적분: t = g(x)로 치환 후 적분',
            ],
            tags: ['치환', '부분'],
          },
          {
            keywords: ['정적분', '급수와 적분', '넓이', '부피'],
            strategies: [
              '급수를 정적분으로 변형하는 식의 구조(dx, x) 이해',
              '입체도형의 부피는 단면적 S(x)를 적분하여 계산',
              '구분구적법과 정적분의 관계',
            ],
            tags: ['부피', '급수'],
          },
        ],
      },
    ],
  },
  // 기하
  {
    grade: '고3',
    semester: '선택',
    units: [
      {
        name: '이차곡선',
        topics: [
          {
            keywords: ['포물선', '타원', '쌍곡선', '이차곡선'],
            strategies: [
              '포물선, 타원, 쌍곡선의 "정의"를 활용해 길이 문제 해결 (가장 중요)',
              '포물선: 초점까지 거리 = 준선까지 거리',
              '타원: 두 초점까지 거리의 합 = 2a (상수)',
            ],
            tags: ['정의', '접선'],
          },
          {
            keywords: ['이차곡선과 직선', '접선'],
            strategies: [
              '공식보다는 정의를 이용하거나 판별식으로 접선 구하기',
              '이차곡선 위의 점에서의 접선의 방정식',
              '이차곡선과 직선의 교점: 연립 후 판별식',
            ],
            tags: ['위치관계', '판별식'],
          },
        ],
      },
      {
        name: '평면벡터',
        topics: [
          {
            keywords: ['벡터', '합', '차', '실수배'],
            strategies: [
              '벡터의 덧셈(삼각형법/평행사변형법)과 뺄셈 시각적 이해',
              '위치벡터를 이용한 점의 좌표 표현',
              '벡터의 실수배: 방향은 같고 크기가 k배',
            ],
            tags: ['합차', '실수배'],
          },
          {
            keywords: ['내적', '성분', '수직'],
            strategies: [
              '내적 공식(성분 곱의 합 / 크기×크기×cos) 활용',
              '두 벡터가 수직이면 내적은 0이다',
              'a·b = |a||b|cos θ = a₁b₁ + a₂b₂',
            ],
            tags: ['성분', '각'],
          },
        ],
      },
      {
        name: '공간도형과 공간좌표',
        topics: [
          {
            keywords: ['삼수선', '정사영', '이면각'],
            strategies: [
              '삼수선 정리의 3가지 케이스를 그림으로 그려서 이해',
              '정사영 넓이 = 원래 넓이 × cos(이면각)',
              '공간에서 직선과 평면의 위치관계 파악',
            ],
            tags: ['삼수선', '정사영'],
          },
          {
            keywords: ['공간좌표', '구', '거리'],
            strategies: [
              '공간좌표에서 두 점 사이의 거리 공식과 구의 방정식 활용',
              '구의 방정식: (x-a)² + (y-b)² + (z-c)² = r²',
              '점과 평면 사이의 거리 공식',
            ],
            tags: ['구', '거리'],
          },
        ],
      },
    ],
  },
];

/**
 * 토픽 문자열에서 매칭되는 학습 전략 찾기
 * - 긴 키워드 우선 매칭 (정확도 향상)
 * - 단어 경계 확인으로 오탐지 방지
 */
export function findMatchingStrategies(topic: string, grade?: string): TopicStrategy | null {
  if (!topic) return null;

  const topicLower = topic.toLowerCase();
  const allCurriculums = [...MIDDLE_SCHOOL_CURRICULUM, ...HIGH_SCHOOL_CURRICULUM];

  // 학년 필터링 (제공된 경우)
  const filteredCurriculums = grade
    ? allCurriculums.filter(c => c.grade.includes(grade.replace(/학년|학기/g, '').trim().slice(0, 2)))
    : allCurriculums;

  // 매칭 결과 수집 (키워드 길이 기반 점수)
  let bestMatch: { strategy: TopicStrategy; score: number } | null = null;

  for (const curriculum of filteredCurriculums) {
    for (const unit of curriculum.units) {
      for (const topicStrategy of unit.topics) {
        // 키워드 매칭 점수 계산
        let score = 0;
        for (const keyword of topicStrategy.keywords) {
          // 너무 짧은 키워드(2자 이하)는 완전 매칭 필요
          if (keyword.length <= 2) {
            // 단어 경계 확인 (한글은 공백/특수문자 기준)
            const regex = new RegExp(`(^|[\\s>])${keyword}($|[\\s>])`, 'i');
            if (regex.test(topic) || topic === keyword) {
              score += keyword.length * 2; // 정확 매칭 보너스
            }
          } else {
            // 긴 키워드는 부분 매칭 허용
            if (topicLower.includes(keyword.toLowerCase()) || topic.includes(keyword)) {
              score += keyword.length;
            }
          }
        }

        // 더 높은 점수의 매칭 선택
        if (score > 0 && (!bestMatch || score > bestMatch.score)) {
          bestMatch = { strategy: topicStrategy, score };
        }
      }
    }
  }

  if (bestMatch) {
    return bestMatch.strategy;
  }

  // 학년 필터 없이 전체 검색 (폴백)
  if (grade) {
    return findMatchingStrategies(topic);
  }

  return null;
}

/**
 * 여러 토픽에서 전략 배열 추출
 */
export function getStrategiesForTopics(topics: string[], grade?: string): string[] {
  const strategiesSet = new Set<string>();

  for (const topic of topics) {
    const match = findMatchingStrategies(topic, grade);
    if (match) {
      match.strategies.forEach(s => strategiesSet.add(s));
    }
  }

  return Array.from(strategiesSet).slice(0, 5);
}

// ============================================
// 단원별 자주 하는 실수 유형
// ============================================

export interface CommonMistake {
  keywords: string[];
  mistakes: string[];
  prevention: string[];
}

export interface UnitMistakes {
  unit: string;
  mistakes: CommonMistake[];
}

export const COMMON_MISTAKES: UnitMistakes[] = [
  // 공통수학1·2
  {
    unit: '다항식과 방정식',
    mistakes: [
      {
        keywords: ['인수분해', '다항식', '곱셈공식'],
        mistakes: [
          '(a-b)² = a²-2ab+b²에서 -2ab를 +2ab로 잘못 계산',
          '완전제곱식 판별 시 중간항 계수 확인 누락',
          '공통인수 묶기 후 나머지 인수 실수',
        ],
        prevention: [
          '곱셈공식 5가지를 반드시 손으로 전개하며 확인',
          '인수분해 결과를 다시 전개하여 검산하는 습관',
        ],
      },
      {
        keywords: ['부등식', '일차부등식', '연립부등식'],
        mistakes: [
          '양변에 음수를 곱할 때 부등호 방향 변경 누락',
          '연립부등식에서 해의 범위 교집합 계산 오류',
        ],
        prevention: [
          '음수 곱셈 시 부등호 방향 바꾸기를 소리내어 확인',
          '수직선 위에 해의 범위를 그려서 확인',
        ],
      },
      {
        keywords: ['분수방정식', '무리방정식', '방정식'],
        mistakes: [
          '분모≠0 조건 확인 누락',
          '무연근 검사 생략',
          '양변 제곱 후 발생하는 무연근 미확인',
        ],
        prevention: [
          '분모가 0이 되는 값을 미리 제외하고 시작',
          '최종 답을 원래 방정식에 대입하여 검산',
        ],
      },
    ],
  },
  {
    unit: '도형의 방정식',
    mistakes: [
      {
        keywords: ['원의 방정식', '원', '중심', '반지름'],
        mistakes: [
          '(x-a)²+(y-b)²=r²에서 중심을 (a,b)가 아닌 (-a,-b)로 착각',
          '일반형에서 표준형 변환 시 완전제곱식 처리 실수',
          'r² 대신 r을 반지름으로 착각',
        ],
        prevention: [
          '중심 좌표의 부호는 방정식 부호와 반대임을 명심',
          '표준형 변환 후 r² > 0인지 확인',
        ],
      },
      {
        keywords: ['점과 직선', '거리', '직선의 방정식'],
        mistakes: [
          '점과 직선 사이 거리 공식에서 절댓값 누락',
          '기울기가 존재하지 않는 경우(수직선) 별도 검토 누락',
          '두 직선의 평행/수직 조건 혼동',
        ],
        prevention: [
          '거리 공식 분자에 절댓값 표시 습관화',
          'x = k 형태의 수직선 케이스 항상 확인',
        ],
      },
    ],
  },
  // 대수(수학I)
  {
    unit: '지수와 로그',
    mistakes: [
      {
        keywords: ['지수', '지수법칙', '지수함수'],
        mistakes: [
          'a^m × a^n = a^(m+n)을 a^(mn)으로 착각',
          '(a^m)^n = a^(mn)을 a^(m+n)으로 혼동',
          '음수의 지수 처리 시 부호 실수',
        ],
        prevention: [
          '지수법칙 3가지를 표로 정리하여 암기',
          '헷갈릴 때는 간단한 수로 대입해서 확인',
        ],
      },
      {
        keywords: ['로그', '로그함수', '상용로그'],
        mistakes: [
          'log(a·b)를 log(a)·log(b)로 착각 (정답: log(a)+log(b))',
          'log(a+b)를 log(a)+log(b)로 잘못 계산',
          '진수 조건(>0)과 밑 조건(>0, ≠1) 확인 누락',
        ],
        prevention: [
          '로그 덧셈은 진수의 곱, 로그 곱셈은 지수로 변환 암기',
          '문제 풀이 전 진수>0, 밑>0, 밑≠1 조건 먼저 체크',
        ],
      },
    ],
  },
  {
    unit: '삼각함수',
    mistakes: [
      {
        keywords: ['삼각함수', '삼각비', 'sin', 'cos', 'tan'],
        mistakes: [
          '사분면별 삼각함수 부호 판단 오류',
          'sin(π/2-θ)=cosθ를 sinθ로 착각',
          'tan의 주기를 2π로 착각 (정답: π)',
        ],
        prevention: [
          '사분면별 부호표(ASTC) 암기: All-Sin-Tan-Cos',
          '특수각 삼각함수 값 표를 자주 보며 암기',
        ],
      },
      {
        keywords: ['삼각방정식', '삼각부등식'],
        mistakes: [
          '일반해 표현 시 주기 누락 (예: +2nπ)',
          '범위 조건 내 해의 개수 세기 실수',
        ],
        prevention: [
          '단위원 그림을 항상 그리며 풀이',
          '주어진 범위를 먼저 표시하고 해 찾기',
        ],
      },
    ],
  },
  {
    unit: '수열',
    mistakes: [
      {
        keywords: ['등차수열', '등비수열', '수열'],
        mistakes: [
          '일반항 aₙ과 합 Sₙ 관계에서 n=1일 때 별도 확인 누락',
          '등비수열 합 공식에서 r=1인 경우 별도 처리 누락',
          '첫째항과 공차/공비 혼동',
        ],
        prevention: [
          'aₙ = Sₙ - Sₙ₋₁ (n≥2)와 a₁ = S₁ 따로 확인',
          'r=1일 때는 Sₙ = na 사용',
        ],
      },
      {
        keywords: ['급수', '무한급수', '급수의 합'],
        mistakes: [
          '수렴 조건 |r|<1 확인 누락',
          '부분분수 분해 후 상쇄 계산 실수',
        ],
        prevention: [
          '무한등비급수 전 |r|<1 조건 먼저 확인',
          '부분합 Sₙ을 구한 후 극한 계산',
        ],
      },
    ],
  },
  // 미적분I(수학II)
  {
    unit: '함수의 극한과 연속',
    mistakes: [
      {
        keywords: ['극한', '함수의 극한', '연속'],
        mistakes: [
          '0/0 꼴 부정형에서 인수분해 실수',
          '좌극한과 우극한이 다른 경우 극한 존재 오판',
          '연속의 3조건 중 일부 확인 누락',
        ],
        prevention: [
          '부정형이면 인수분해/유리화 시도',
          '극한값 ≠ 함수값이면 불연속',
        ],
      },
    ],
  },
  {
    unit: '미분',
    mistakes: [
      {
        keywords: ['미분', '도함수', '미분계수'],
        mistakes: [
          '미분가능하면 연속이다(역은 성립 안 함) 조건 혼동',
          '접선의 방정식에서 접점 좌표 대입 실수',
          '곱의 미분, 합성함수 미분 공식 적용 오류',
        ],
        prevention: [
          '미분가능 → 연속 (O), 연속 → 미분가능 (X) 명확히 구분',
          '접선 구하기: 접점 좌표 → 기울기 f\'(a) → 직선 방정식 순서',
        ],
      },
      {
        keywords: ['극대', '극소', '극값', '최대', '최소'],
        mistakes: [
          'f\'(x)=0인 점이 항상 극값이라고 착각 (부호 변화 필요)',
          '닫힌 구간에서 최댓값/최솟값 구할 때 양 끝점 확인 누락',
          '변곡점과 극값 개념 혼동',
        ],
        prevention: [
          '극값 판정: f\'(x)=0이고 전후 부호가 바뀌어야 함',
          '닫힌 구간 [a,b]에서는 f(a), f(b), 극값 모두 비교',
        ],
      },
    ],
  },
  {
    unit: '적분',
    mistakes: [
      {
        keywords: ['부정적분', '적분', '원시함수'],
        mistakes: [
          '적분상수 C 누락',
          '∫xⁿdx에서 n=-1일 때 ln|x| 사용 누락',
          '치환적분에서 dx 변환 실수',
        ],
        prevention: [
          '부정적분 답에 + C 쓰기를 습관화',
          'n=-1이면 자연로그로 전환',
        ],
      },
      {
        keywords: ['정적분', '정적분의 활용', '넓이'],
        mistakes: [
          '상한·하한 대입 순서 오류 (F(b) - F(a) 순서)',
          '곡선 아래 넓이에서 음수 구간 처리 누락',
          '두 곡선 사이 넓이에서 위/아래 함수 구분 실수',
        ],
        prevention: [
          '정적분 = F(위) - F(아래) 순서 암기',
          '넓이는 항상 절댓값 또는 적분 구간 분리',
        ],
      },
    ],
  },
  // 확률과 통계
  {
    unit: '순열과 조합',
    mistakes: [
      {
        keywords: ['순열', '조합', '경우의 수'],
        mistakes: [
          '순열(순서 O)과 조합(순서 X) 구분 실패',
          '원순열에서 (n-1)! 적용 누락',
          '같은 것이 있는 순열에서 나누기 누락',
        ],
        prevention: [
          '"순서가 중요하면 P, 아니면 C" 판단 먼저',
          '원탁 배열은 한 명 고정 후 나머지 배열',
        ],
      },
      {
        keywords: ['이항정리', '이항계수'],
        mistakes: [
          '일반항에서 r과 n-r 혼동',
          '파스칼 삼각형 성질 적용 실수',
        ],
        prevention: [
          '(a+b)ⁿ의 r번째 항: ₙCᵣ aⁿ⁻ʳ bʳ 공식 정리',
        ],
      },
    ],
  },
  {
    unit: '확률',
    mistakes: [
      {
        keywords: ['확률', '조건부확률', '독립'],
        mistakes: [
          '여사건 확률 계산 후 1에서 빼기 누락',
          'P(A|B)와 P(B|A) 혼동',
          '독립사건과 배반사건 개념 혼동',
        ],
        prevention: [
          '"~가 아닐 확률"이면 여사건 고려',
          '조건부확률: P(A|B) = P(A∩B)/P(B) 공식 암기',
          '독립: P(A∩B)=P(A)P(B), 배반: A∩B=∅ 구분',
        ],
      },
    ],
  },
  {
    unit: '통계',
    mistakes: [
      {
        keywords: ['정규분포', '표준정규분포', '확률분포'],
        mistakes: [
          '표준화 공식 Z = (X-μ)/σ에서 부호 실수',
          '확률 구간 계산에서 대칭성 적용 오류',
          '표본평균의 분포와 모평균 혼동',
        ],
        prevention: [
          '표준화 후 표준정규분포표 읽기 연습',
          'P(Z≤-a) = 1 - P(Z≤a) 대칭성 활용',
        ],
      },
    ],
  },
  // 미적분II
  {
    unit: '지수로그 미적분',
    mistakes: [
      {
        keywords: ['지수함수 미분', '로그함수 미분', 'eˣ'],
        mistakes: [
          '(aˣ)\' = aˣ ln a에서 ln a 누락',
          '(ln x)\' = 1/x (x>0) 조건 누락',
          '합성함수 미분 시 내부 함수 미분 누락',
        ],
        prevention: [
          '지수함수 미분 공식에 ln(밑) 곱하기 체크',
          '합성함수: 겉미분 × 속미분 순서',
        ],
      },
    ],
  },
  {
    unit: '적분법',
    mistakes: [
      {
        keywords: ['부분적분', '치환적분'],
        mistakes: [
          '부분적분 반복 시 부호(+/-) 번갈아 적용 실수',
          '치환적분에서 적분 범위 변환 누락',
          'LIATE 규칙 적용 실수',
        ],
        prevention: [
          '부분적분 도표법으로 부호 관리',
          '치환 시 상한·하한도 함께 변환',
        ],
      },
    ],
  },
  // 기하
  {
    unit: '이차곡선',
    mistakes: [
      {
        keywords: ['포물선', '타원', '쌍곡선'],
        mistakes: [
          '포물선 초점 좌표 부호 오류',
          '타원의 장축/단축 구분 실패 (a>b 조건)',
          '쌍곡선 점근선 공식 혼동',
        ],
        prevention: [
          '포물선 y²=4px: 초점(p,0), 준선 x=-p 정리',
          '타원: 긴 축이 장축, 짧은 축이 단축',
        ],
      },
    ],
  },
  {
    unit: '벡터',
    mistakes: [
      {
        keywords: ['벡터', '내적', '외적'],
        mistakes: [
          '벡터 내적 계산 시 각도 적용 오류',
          '위치벡터와 방향벡터 혼동',
          '벡터의 크기에 절댓값 표시 누락',
        ],
        prevention: [
          '내적: a·b = |a||b|cosθ 또는 성분 곱의 합',
          '벡터 크기: |a| = √(성분 제곱의 합)',
        ],
      },
    ],
  },
];

/**
 * 토픽에 해당하는 자주 하는 실수 찾기
 */
export function findCommonMistakes(topic: string): CommonMistake | null {
  if (!topic) return null;

  const topicLower = topic.toLowerCase();

  for (const unitMistakes of COMMON_MISTAKES) {
    for (const mistake of unitMistakes.mistakes) {
      for (const keyword of mistake.keywords) {
        if (topicLower.includes(keyword.toLowerCase()) || topic.includes(keyword)) {
          return mistake;
        }
      }
    }
  }

  return null;
}

// ============================================
// 수준별 학습 전략
// ============================================

export interface LevelStrategy {
  level: string;
  targetGrade: string;
  description: string;
  coreStrategies: string[];
  studyHours: string;
  recommendedBooks: string[];
  keyPrinciple: string;
}

export const LEVEL_STRATEGIES: LevelStrategy[] = [
  {
    level: '하위권',
    targetGrade: '5등급 이하 → 3~4등급 목표',
    description: '기초 개념 재정립이 최우선',
    coreStrategies: [
      '중학교 수학 개념 점검 필수 - 빈 개념이 발견되면 해당 학년으로 돌아가 복습',
      '문제집보다 교과서 기본 개념과 예제 문제에 집중',
      '본인 수준보다 약간 쉬운 문제집 선택으로 자신감 구축',
      '양치기보다 한 문제를 완벽히 이해하는 것이 중요',
      '모르는 문제는 5분 고민 후 해설 확인 → 다시 풀기',
    ],
    studyHours: '하루 최소 2시간 이상 수학 투자',
    recommendedBooks: ['풍산자 (개념 쉽게)', '베이직쎈 (기초)', '라이트쎈 (기본)'],
    keyPrinciple: '어설픈 선행보다 확실한 복습이 훨씬 중요합니다.',
  },
  {
    level: '중위권',
    targetGrade: '3~4등급 → 2등급 안정화 목표',
    description: '개념의 "왜"를 이해하는 것이 핵심',
    coreStrategies: [
      '1주일 내 기본 개념 완벽 이해',
      '공식을 마인드맵으로 정리하여 머릿속 구조화',
      '기출문제 10회분 풀이 (유형 파악)',
      '같은 문제 25분 내 재풀이 (속도 훈련)',
      '오답노트 작성 후 주기적 복습 (당일 → 3일 후 → 1주일 후)',
    ],
    studyHours: '하루 3~4시간 수학 집중 투자',
    recommendedBooks: ['개념원리', '개념원리 RPM', '쎈 A~B단계'],
    keyPrinciple: '공식 암기만으로는 한계가 있습니다. "왜 이 공식이 성립하는가?"를 이해해야 응용력이 향상됩니다.',
  },
  {
    level: '상위권',
    targetGrade: '1~2등급 → 1등급 안정화 및 만점 목표',
    description: '실수 없이 전부 맞추는 완벽함이 필요',
    coreStrategies: [
      '두 개 이상의 개념이 결합된 복합 문제 연습',
      '시험과 동일한 조건(50분, OMR 카드)으로 실전 모의',
      '객관식도 풀이 과정 완벽히 작성하는 습관',
      '킬러문항 대비 심화 문제집 병행',
      '실수 패턴 분석 및 체크리스트화',
    ],
    studyHours: '하루 2~3시간 (효율 중심)',
    recommendedBooks: ['쎈 B~C단계', '일품', '블랙라벨'],
    keyPrinciple: '"아는 것을 맞고, 모르는 것은 틀리는" 수준을 넘어 "실수 없이 전부 맞추는" 완벽함이 필요합니다.',
  },
];

// ============================================
// 시험 시간 배분 전략
// ============================================

export interface TimeStrategy {
  phase: string;
  questionRange: string;
  timeAllocation: string;
  perQuestion: string;
  tips: string[];
}

export const TIME_STRATEGIES: TimeStrategy[] = [
  {
    phase: '1단계',
    questionRange: '기본 유형 (1~10번)',
    timeAllocation: '15~20분',
    perQuestion: '문제당 1~2분',
    tips: [
      '빠르게 풀되 계산 실수 주의',
      '확실한 문제로 기본 점수 확보',
    ],
  },
  {
    phase: '2단계',
    questionRange: '중간 난이도 (11~18번)',
    timeAllocation: '20~25분',
    perQuestion: '문제당 2~3분',
    tips: [
      '풀이 방향이 바로 안 보이면 별표 표시 후 넘기기',
      '시간 소모가 큰 문제는 나중에',
    ],
  },
  {
    phase: '3단계',
    questionRange: '고난도 (19~25번)',
    timeAllocation: '15~20분',
    perQuestion: '문제당 3~5분',
    tips: [
      '배점 높은 문제 우선 공략',
      '부분점수 노리는 전략 사용',
    ],
  },
  {
    phase: '검토',
    questionRange: '전체',
    timeAllocation: '10~15분',
    perQuestion: '-',
    tips: [
      'OMR 마킹 확인',
      '계산 실수 점검 (특히 부호)',
      '조건 누락 여부 재확인',
    ],
  },
];

// ============================================
// 서술형 감점 방지 체크리스트
// ============================================

export interface EssayCheckItem {
  category: string;
  checkPoints: string[];
  commonErrors: string[];
}

export const ESSAY_CHECKLIST: EssayCheckItem[] = [
  {
    category: '풀이 과정',
    checkPoints: [
      '모든 계산 단계를 명시했는가?',
      '사용한 공식/정리를 기재했는가?',
      '논리적 비약 없이 전개했는가?',
    ],
    commonErrors: [
      '중간 단계 생략',
      '풀이 순서 오류',
      '공식 적용 근거 누락',
    ],
  },
  {
    category: '조건 확인',
    checkPoints: [
      '문제의 모든 조건을 사용했는가?',
      '변수의 범위 조건을 확인했는가?',
      '특수한 경우(0, 음수 등)를 검토했는가?',
    ],
    commonErrors: [
      '조건 일부 누락',
      '정의역/치역 범위 무시',
      '분모≠0 조건 미확인',
    ],
  },
  {
    category: '형식 요건',
    checkPoints: [
      '등호를 연속으로 사용하지 않았는가?',
      '단위를 표기했는가?',
      '최종 답을 명확히 표기했는가?',
    ],
    commonErrors: [
      'a = b = c 형태의 연속 등호',
      '단위 미표기',
      '최종답 불명확',
    ],
  },
  {
    category: '계산 정확성',
    checkPoints: [
      '부호 처리가 정확한가?',
      '괄호 처리가 올바른가?',
      '약분/통분이 정확한가?',
    ],
    commonErrors: [
      '음수 부호 실수',
      '괄호 전개 오류',
      '약분 누락',
    ],
  },
];

// ============================================
// 4주 전 학습 타임라인
// ============================================

export interface StudyTimeline {
  week: string;
  title: string;
  tasks: string[];
}

export const FOUR_WEEK_TIMELINE: StudyTimeline[] = [
  {
    week: '4주 전',
    title: '계획 및 개념 점검',
    tasks: [
      '시험 범위 확인 및 학습 계획표 수립',
      '개념 전체 훑기 (빠르게 1회독)',
      '부족한 단원 파악',
    ],
  },
  {
    week: '3주 전',
    title: '개념 완성',
    tasks: [
      '교과서 2~3회독으로 개념 완벽 이해',
      '기본 유형 문제집 1회독',
      '공식 정리 노트 작성',
    ],
  },
  {
    week: '2주 전',
    title: '유형 및 기출',
    tasks: [
      '기출문제 분석 및 풀이',
      '응용/심화 문제 도전',
      '오답노트 본격 작성',
    ],
  },
  {
    week: '1주 전',
    title: '마무리 및 실전',
    tasks: [
      '오답노트 총복습',
      '실전 모의 시험 (시간 제한)',
      '컨디션 조절 및 자신감 유지',
    ],
  },
];

// ============================================
// 학년별 연계 경고 (중→고 연계 핵심 단원)
// ============================================

export interface GradeConnection {
  fromGrade: string;
  fromTopic: string;
  toGrade: string;
  toTopics: string[];
  importance: 'critical' | 'high' | 'medium';
  warning: string;
  checkItems: string[];
}

export const GRADE_CONNECTIONS: GradeConnection[] = [
  // 중3 → 고등 전 과정 연계
  {
    fromGrade: '중3',
    fromTopic: '인수분해',
    toGrade: '고1~고3',
    toTopics: ['다항식', '이차방정식', '이차함수', '미분', '적분'],
    importance: 'critical',
    warning: '인수분해는 고등 수학 전 과정의 핵심 도구입니다. 중3 때 완벽히 마스터하지 않으면 고등 수학 전체에서 어려움을 겪습니다.',
    checkItems: [
      '완전제곱식 인수분해가 바로 되는가?',
      '합차공식을 자유롭게 활용하는가?',
      '복잡한 식에서 공통인수를 빠르게 찾는가?',
      '치환을 이용한 인수분해가 가능한가?',
    ],
  },
  {
    fromGrade: '중3',
    fromTopic: '이차방정식',
    toGrade: '고1',
    toTopics: ['복소수', '고차방정식', '이차부등식'],
    importance: 'critical',
    warning: '근의 공식, 판별식 활용이 고등 방정식 파트의 기초입니다.',
    checkItems: [
      '근의 공식을 3초 내에 쓸 수 있는가?',
      '판별식 D로 근의 개수를 바로 판별하는가?',
      '근과 계수의 관계를 활용할 수 있는가?',
    ],
  },
  {
    fromGrade: '중3',
    fromTopic: '이차함수',
    toGrade: '고1~고2',
    toTopics: ['이차함수와 방정식', '도함수의 활용', '이차부등식'],
    importance: 'critical',
    warning: '이차함수의 그래프 해석 능력이 고등 함수 단원의 기반입니다.',
    checkItems: [
      '표준형 ↔ 일반형 변환이 자유로운가?',
      '꼭짓점, 축, 최댓값/최솟값을 바로 구하는가?',
      'x축과의 교점 개수를 그래프로 판단하는가?',
    ],
  },
  // 중2 → 고1 연계
  {
    fromGrade: '중2',
    fromTopic: '일차함수',
    toGrade: '고1',
    toTopics: ['직선의 방정식', '원의 방정식', '도형의 이동'],
    importance: 'high',
    warning: '일차함수의 기울기·절편 개념이 고1 도형의 방정식 단원에 직접 연결됩니다.',
    checkItems: [
      '기울기의 의미를 정확히 이해하는가?',
      '두 직선의 평행/수직 조건을 알고 있는가?',
      'x절편, y절편 개념이 명확한가?',
    ],
  },
  {
    fromGrade: '중2',
    fromTopic: '연립방정식',
    toGrade: '고1',
    toTopics: ['연립이차방정식', '두 곡선의 교점'],
    importance: 'high',
    warning: '가감법·대입법 숙달이 고등 연립방정식 풀이의 기초입니다.',
    checkItems: [
      '가감법과 대입법 중 효율적인 방법을 선택하는가?',
      '해가 없거나 무수히 많은 경우를 판별하는가?',
    ],
  },
  // 중3 → 고2 연계
  {
    fromGrade: '중3',
    fromTopic: '삼각비',
    toGrade: '고2',
    toTopics: ['삼각함수', '삼각함수의 그래프', '삼각방정식'],
    importance: 'critical',
    warning: '30°, 45°, 60°의 삼각비 값 암기는 삼각함수 단원의 절대 전제입니다.',
    checkItems: [
      '특수각의 sin, cos, tan 값을 즉시 말할 수 있는가?',
      'sin²θ + cos²θ = 1 항등식을 활용하는가?',
      '직각삼각형에서 삼각비를 정의할 수 있는가?',
    ],
  },
  {
    fromGrade: '중3',
    fromTopic: '피타고라스 정리',
    toGrade: '고2~고3',
    toTopics: ['삼각함수', '평면벡터', '공간도형'],
    importance: 'high',
    warning: '피타고라스 정리는 기하 전 영역에서 사용되는 핵심 도구입니다.',
    checkItems: [
      '피타고라스의 수(3-4-5, 5-12-13)를 암기하고 있는가?',
      '도형 문제에서 직각삼각형을 찾아 적용하는가?',
    ],
  },
  // 중1 → 중2~고등 연계
  {
    fromGrade: '중1',
    fromTopic: '소인수분해',
    toGrade: '중2~고1',
    toTopics: ['약수와 배수 활용', '분수의 유한소수 판별', '정수론 기초'],
    importance: 'high',
    warning: '소인수분해는 약수/배수 문제와 유한소수 판별의 핵심 도구입니다.',
    checkItems: [
      '빠른 소인수분해가 가능한가?',
      '약수의 개수를 공식으로 구하는가?',
      '유한소수 조건(분모의 소인수가 2, 5뿐)을 아는가?',
    ],
  },
  {
    fromGrade: '중1',
    fromTopic: '정수와 유리수',
    toGrade: '중2~고1',
    toTopics: ['실수', '복소수', '부등식'],
    importance: 'medium',
    warning: '음수 계산과 절댓값 개념이 부등식·복소수 학습의 기초입니다.',
    checkItems: [
      '음수의 사칙연산에서 부호 실수가 없는가?',
      '절댓값의 정의와 성질을 알고 있는가?',
    ],
  },
  // 고1 → 고2 연계
  {
    fromGrade: '고1',
    fromTopic: '복소수',
    toGrade: '고2~고3',
    toTopics: ['허근을 갖는 이차방정식', '방정식의 실근 조건'],
    importance: 'high',
    warning: '복소수 기초가 부실하면 방정식 단원에서 실근/허근 판별에 어려움을 겪습니다.',
    checkItems: [
      'i²=-1, i³=-i, i⁴=1 등 i의 거듭제곱을 아는가?',
      '켤레복소수의 성질을 활용하는가?',
      '복소수의 상등 조건을 이해하는가?',
    ],
  },
  {
    fromGrade: '고1',
    fromTopic: '순열과 조합',
    toGrade: '고2',
    toTopics: ['확률', '이항정리', '이항분포'],
    importance: 'critical',
    warning: '순열·조합 계산이 불안정하면 확률과 통계 전체가 흔들립니다.',
    checkItems: [
      '순열과 조합의 차이를 명확히 구분하는가?',
      'P, C 공식을 빠르게 계산하는가?',
      '중복순열, 원순열, 같은 것이 있는 순열을 구분하는가?',
    ],
  },
  // 고2 → 고3 연계
  {
    fromGrade: '고2',
    fromTopic: '지수와 로그',
    toGrade: '고3',
    toTopics: ['지수함수 미분', '로그함수 미분', '적분'],
    importance: 'critical',
    warning: '지수·로그 법칙 숙달 없이는 미적분 II 학습이 불가능합니다.',
    checkItems: [
      '지수법칙 3가지를 정확히 구분하는가?',
      '로그 덧셈/뺄셈 법칙을 자유롭게 쓰는가?',
      '진수 조건(>0)과 밑 조건(>0, ≠1)을 항상 체크하는가?',
    ],
  },
  {
    fromGrade: '고2',
    fromTopic: '수열',
    toGrade: '고3',
    toTopics: ['수열의 극한', '급수', '적분과 급수'],
    importance: 'high',
    warning: '등차/등비수열 일반항과 합 공식이 급수 단원의 기반입니다.',
    checkItems: [
      '등차수열, 등비수열 일반항을 즉시 쓸 수 있는가?',
      'Σ 기호 계산이 자유로운가?',
      '부분분수 분해를 활용한 급수 계산이 가능한가?',
    ],
  },
];

/**
 * 현재 단원과 연계된 선수학습 경고 찾기
 */
export function findGradeConnections(topic: string, currentGrade?: string): GradeConnection[] {
  if (!topic) return [];

  const topicLower = topic.toLowerCase();
  const connections: GradeConnection[] = [];

  for (const conn of GRADE_CONNECTIONS) {
    // 현재 배우는 단원(toTopics)에서 매칭
    const isRelatedTopic = conn.toTopics.some(t =>
      topicLower.includes(t.toLowerCase()) || t.toLowerCase().includes(topicLower)
    );

    // 선수학습 단원(fromTopic)에서 매칭
    const isPrerequisite = topicLower.includes(conn.fromTopic.toLowerCase()) ||
      conn.fromTopic.toLowerCase().includes(topicLower);

    if (isRelatedTopic || isPrerequisite) {
      // 학년 필터 (현재 학년보다 낮은 선수학습만)
      if (currentGrade) {
        const gradeOrder: Record<string, number> = {
          '중1': 1, '중2': 2, '중3': 3,
          '고1': 4, '고2': 5, '고3': 6
        };
        const current = gradeOrder[currentGrade.slice(0, 2)] || 0;
        const from = gradeOrder[conn.fromGrade] || 0;
        if (from < current || isPrerequisite) {
          connections.push(conn);
        }
      } else {
        connections.push(conn);
      }
    }
  }

  return connections;
}

// ============================================
// 서술형 심화 가이드
// ============================================

export interface EssayTemplate {
  situation: string;
  template: string;
  example: string;
}

export interface EssayAdvancedGuide {
  category: string;
  title: string;
  description: string;
  templates: EssayTemplate[];
  scoringTips: string[];
}

export const ESSAY_ADVANCED_GUIDE: EssayAdvancedGuide[] = [
  {
    category: 'reasoning',
    title: '근거 명시 표현',
    description: '채점자가 논리적 흐름을 따라갈 수 있도록 근거를 명확히 제시합니다.',
    templates: [
      {
        situation: '공식/정리 적용 시',
        template: '[정리명]에 의해 ~이다.',
        example: '피타고라스 정리에 의해 c² = a² + b²이다.',
      },
      {
        situation: '조건 활용 시',
        template: '문제의 조건 "~"에서 ~을 얻는다.',
        example: '문제의 조건 "x > 0"에서 x의 범위가 양수임을 얻는다.',
      },
      {
        situation: '계산 결과 도출 시',
        template: '~이므로 ~이다.',
        example: 'x² = 4이고 x > 0이므로 x = 2이다.',
      },
      {
        situation: '논리적 귀결 시',
        template: '따라서 ~가 성립한다.',
        example: '따라서 삼각형 ABC는 직각삼각형이 성립한다.',
      },
      {
        situation: '가정 설정 시',
        template: '~라 하면 ~이다.',
        example: 'AB = x라 하면 BC = 2x이다.',
      },
    ],
    scoringTips: [
      '"~에 의해", "~이므로", "따라서"를 적절히 사용하면 논리 점수 확보',
      '공식명을 생략하지 말고 명시할 것 (예: "근의 공식에 의해")',
      '조건을 인용할 때 따옴표 또는 괄호로 표시하면 명확',
    ],
  },
  {
    category: 'structure',
    title: '논리적 전개 템플릿',
    description: '서술형 답안의 기본 구조를 따르면 채점 기준에 맞는 답안이 됩니다.',
    templates: [
      {
        situation: '증명 문제',
        template: '1. 주어진 조건 정리 → 2. 목표 명시 → 3. 단계별 추론 → 4. 결론',
        example: '[조건] ABC가 직각삼각형 → [목표] c² = a² + b² 증명 → [추론] 직각의 위치... → [결론] 따라서 성립',
      },
      {
        situation: '값 구하기 문제',
        template: '1. 미지수 설정 → 2. 조건을 식으로 표현 → 3. 방정식 풀이 → 4. 검산 및 답',
        example: '[설정] x = AB의 길이 → [식] 2x + 3 = 15 → [풀이] x = 6 → [답] AB = 6',
      },
      {
        situation: '그래프 해석 문제',
        template: '1. 함수식 확인 → 2. 주요 특성 파악 → 3. 조건 대입 → 4. 결론 도출',
        example: '[함수] y = x² - 4x + 3 → [특성] 꼭짓점 (2, -1) → [조건] x = 0 대입 → [결론] y절편 3',
      },
    ],
    scoringTips: [
      '각 단계를 줄 바꿈으로 구분하면 가독성 향상',
      '단계 번호(①②③ 또는 1.2.3.)를 붙이면 구조 점수 확보',
      '마지막에 "∴ 답: ~" 형식으로 명확히 표기',
    ],
  },
  {
    category: 'scoring',
    title: '채점 기준 역설계',
    description: '교사가 채점표를 만드는 방식을 이해하면 부분점수를 최대화할 수 있습니다.',
    templates: [
      {
        situation: '일반적 채점 배점',
        template: '풀이 시작 (1점) → 핵심 공식 적용 (2점) → 중간 결과 (1점) → 최종 답 (1점)',
        example: '5점 문제: 식 세우기 1점 + 공식 적용 2점 + 계산 1점 + 답 1점',
      },
      {
        situation: '증명 문제 채점',
        template: '조건 파악 (1점) → 논리 전개 (2-3점) → 결론 도출 (1점)',
        example: '4점 증명: 가정 명시 1점 + 추론 과정 2점 + 결론 1점',
      },
      {
        situation: '도형 문제 채점',
        template: '보조선/설정 (1점) → 관계식 유도 (2점) → 계산 (1점) → 답 (1점)',
        example: '5점 도형: 직각삼각형 찾기 1점 + 피타고라스 적용 2점 + 계산 1점 + 답 1점',
      },
    ],
    scoringTips: [
      '시간이 부족해도 "식 세우기"만으로 부분점수 획득 가능',
      '답을 모르더라도 알고 있는 공식을 적용한 과정은 점수가 됨',
      '최종 답이 틀려도 풀이 과정이 맞으면 대부분 점수 부여',
      '"식만 쓰고 넘어가는 것"보다 "틀려도 끝까지 푸는 것"이 유리',
    ],
  },
  {
    category: 'common_deductions',
    title: '흔한 감점 사유',
    description: '자주 발생하는 감점 유형을 미리 파악하고 방지합니다.',
    templates: [
      {
        situation: '등호 오용',
        template: '3 = 2x = x + 1 (X) → 2x = 3, 따라서 x = 1.5 (O)',
        example: '연속 등호 사용 금지: 각 식을 개별 문장으로 분리',
      },
      {
        situation: '단위 누락',
        template: 'x = 5 (X) → x = 5 cm (O)',
        example: '길이, 넓이, 부피 등 단위가 있는 문제는 반드시 단위 표기',
      },
      {
        situation: '범위 조건 무시',
        template: 'x = ±3 (X, x > 0 조건 무시) → x = 3 (O)',
        example: '문제 조건에 명시된 범위를 항상 확인하고 적용',
      },
      {
        situation: '검산 생략',
        template: '무연근이 발생하는 문제에서 대입 검증 없이 답 제출',
        example: '분수방정식, 무리방정식은 반드시 원래 식에 대입하여 검산',
      },
    ],
    scoringTips: [
      '등호(=)를 한 줄에 하나만 사용하는 습관',
      '계산 끝나면 단위 체크',
      '조건이 있으면 답에서 필터링',
      '시간 남으면 주요 문제 검산',
    ],
  },
];

/**
 * 서술형 가이드 카테고리별 조회
 */
export function getEssayGuideByCategory(category: string): EssayAdvancedGuide | null {
  return ESSAY_ADVANCED_GUIDE.find(g => g.category === category) || null;
}

// ============================================
// 단원별 킬러 문항 유형
// ============================================

export interface KillerPattern {
  pattern: string;
  difficulty: '상' | '최상';
  frequency: '자주출제' | '가끔출제';
  trapDescription: string;
  solutionKey: string[];
  exampleSetup: string;
}

export interface KillerQuestionType {
  unit: string;
  keywords: string[];
  killerPatterns: KillerPattern[];
}

export const KILLER_QUESTION_TYPES: KillerQuestionType[] = [
  // 공통수학 - 방정식
  {
    unit: '이차방정식과 이차함수',
    keywords: ['이차방정식', '이차함수', '판별식', '근'],
    killerPatterns: [
      {
        pattern: '근의 분리 조건',
        difficulty: '최상',
        frequency: '자주출제',
        trapDescription: '두 근이 특정 범위에 존재하는 조건을 구하는 문제. 판별식만 사용하면 함정에 빠짐.',
        solutionKey: [
          '① 판별식 D ≥ 0 (실근 존재)',
          '② 축의 위치: -b/2a의 범위',
          '③ 경계값: f(a)와 f(b)의 부호',
          '세 조건을 모두 연립하여 범위 결정',
        ],
        exampleSetup: '이차방정식 x² - 2ax + a + 2 = 0의 두 근이 모두 1보다 클 조건',
      },
      {
        pattern: '이차함수 최대/최소의 장난',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '정의역이 제한된 이차함수에서 최댓값/최솟값. 꼭짓점이 정의역 밖에 있으면 함정.',
        solutionKey: [
          '꼭짓점의 x좌표가 정의역 내부/외부인지 확인',
          '정의역 양 끝점에서의 함수값 계산',
          '세 값(꼭짓점, 양 끝) 중 최대/최소 판별',
        ],
        exampleSetup: 'f(x) = x² - 4x + 5 (0 ≤ x ≤ 5)의 최댓값과 최솟값',
      },
    ],
  },
  // 고1 - 도형의 방정식
  {
    unit: '도형의 방정식',
    keywords: ['원', '직선', '접선', '교점', '거리'],
    killerPatterns: [
      {
        pattern: '원과 직선의 위치관계 종합',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '원과 직선이 만나는 조건, 접하는 조건, 현의 길이 구하기를 혼합한 문제.',
        solutionKey: [
          '중심과 직선 사이 거리 d 계산',
          'd < r: 두 점에서 만남 (현의 길이 = 2√(r² - d²))',
          'd = r: 접함',
          'd > r: 만나지 않음',
        ],
        exampleSetup: '원 x² + y² = 25와 직선 3x + 4y = k가 접할 때 k의 값',
      },
      {
        pattern: '자취 문제',
        difficulty: '최상',
        frequency: '가끔출제',
        trapDescription: '조건을 만족하는 점의 자취(궤적)를 구하는 문제. 매개변수 소거 과정에서 실수 유발.',
        solutionKey: [
          '움직이는 점 P(x, y) 설정',
          '조건을 x, y로 표현',
          '매개변수 소거하여 x, y만의 방정식 유도',
          '정의역 조건 확인 필수',
        ],
        exampleSetup: '원 위의 점 A와 x축 위의 점 B에 대해 선분 AB의 중점 P의 자취',
      },
    ],
  },
  // 고1 - 경우의 수
  {
    unit: '순열과 조합',
    keywords: ['순열', '조합', '경우의 수', '이항계수'],
    killerPatterns: [
      {
        pattern: '조건부 경우의 수',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '특정 조건(인접, 사이에 배치 등)이 있는 배열 문제. 직접 나열하면 오래 걸림.',
        solutionKey: [
          '조건을 만족하는 경우를 먼저 고정',
          '나머지를 배열하는 경우의 수 계산',
          '여사건(전체 - 조건 위배) 활용 고려',
        ],
        exampleSetup: 'A, B, C, D, E 5명을 한 줄로 세울 때 A와 B가 이웃하지 않는 경우의 수',
      },
      {
        pattern: '합답형(ㄱㄴㄷ) 문항',
        difficulty: '최상',
        frequency: '자주출제',
        trapDescription: '여러 명제의 참/거짓을 판별하는 문제. 하나라도 틀리면 전체가 오답.',
        solutionKey: [
          '각 명제를 독립적으로 검토',
          '반례를 찾아 거짓 명제 제거',
          '명제가 헷갈리면 구체적인 수 대입으로 확인',
          '시간 배분 중요: 한 문제에 너무 매달리지 않기',
        ],
        exampleSetup: 'ㄱ. nCr = nCn-r, ㄴ. nPr ≥ nCr, ㄷ. 0! = 1 중 옳은 것을 모두 고르시오.',
      },
    ],
  },
  // 고1 - 행렬
  {
    unit: '행렬',
    keywords: ['행렬', '역행렬', '행렬의 곱'],
    killerPatterns: [
      {
        pattern: 'AB ≠ BA 함정',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '행렬 곱셈의 비교환성을 이용한 함정. 습관적으로 교환법칙 적용하면 오답.',
        solutionKey: [
          '행렬 곱셈은 교환법칙 성립 안 함 (AB ≠ BA)',
          'A² - B² ≠ (A+B)(A-B) 주의',
          '(A+B)² ≠ A² + 2AB + B² 주의',
          '직접 계산으로 확인',
        ],
        exampleSetup: 'A² - B² = (A+B)(A-B)가 성립하려면 어떤 조건이 필요한가?',
      },
      {
        pattern: '역행렬 존재 조건',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '역행렬이 존재하지 않는 경우(ad - bc = 0)를 놓치는 실수.',
        solutionKey: [
          '2×2 행렬의 행렬식 ad - bc 계산',
          'ad - bc = 0이면 역행렬 없음',
          '역행렬 존재하지 않는 조건으로 방정식 세우기',
        ],
        exampleSetup: '행렬 A = [[a, 2], [3, a]]의 역행렬이 존재하지 않는 a의 값',
      },
    ],
  },
  // 수학I - 지수로그
  {
    unit: '지수와 로그',
    keywords: ['지수', '로그', '지수방정식', '로그방정식'],
    killerPatterns: [
      {
        pattern: '밑/진수 조건 함정',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '로그 진수>0, 밑>0 및 밑≠1 조건 확인 누락으로 무연근 포함.',
        solutionKey: [
          '문제 풀이 전 진수 > 0, 밑 > 0, 밑 ≠ 1 조건 먼저 확인',
          '방정식을 풀고 나서 조건에 맞는지 대입 검증',
          '지수방정식에서 밑이 음수인 경우 특별 주의',
        ],
        exampleSetup: 'log₂(x-1) + log₂(x+1) = 3의 해를 구하시오.',
      },
      {
        pattern: '로그 법칙 역이용',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: 'log를 분리/합치는 과정에서 실수 유발. log(a+b) ≠ log(a) + log(b).',
        solutionKey: [
          'log(a·b) = log(a) + log(b) (O)',
          'log(a+b) ≠ log(a) + log(b) (X)',
          '헷갈리면 간단한 수 대입해서 확인',
        ],
        exampleSetup: 'log₁₀2 = a, log₁₀3 = b일 때 log₁₀15를 a, b로 나타내시오.',
      },
    ],
  },
  // 수학I - 삼각함수
  {
    unit: '삼각함수',
    keywords: ['삼각함수', '삼각방정식', '삼각부등식', 'sin', 'cos', 'tan'],
    killerPatterns: [
      {
        pattern: '일반해 표현',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '삼각방정식의 일반해를 구할 때 주기를 빠뜨리거나 범위 내 해 개수 오산.',
        solutionKey: [
          '단위원 그림을 그려서 모든 해 위치 파악',
          '주기를 고려한 일반해 표현 (예: θ = π/6 + 2nπ 또는 5π/6 + 2nπ)',
          '주어진 범위 내에서 n 값 대입하여 해 찾기',
        ],
        exampleSetup: '0 ≤ x < 2π에서 sin x = 1/2의 모든 해',
      },
      {
        pattern: '삼각함수 합성',
        difficulty: '최상',
        frequency: '가끔출제',
        trapDescription: 'a sin x + b cos x 형태를 r sin(x + α)로 변환하는 과정에서 부호 실수.',
        solutionKey: [
          'r = √(a² + b²) 계산',
          'tan α = b/a로 α 결정 (사분면 주의)',
          '합성 후 최댓값 r, 최솟값 -r',
        ],
        exampleSetup: '3 sin x + 4 cos x의 최댓값',
      },
    ],
  },
  // 수학I - 수열
  {
    unit: '수열',
    keywords: ['수열', '등차', '등비', '귀납법', '급수'],
    killerPatterns: [
      {
        pattern: 'aₙ과 Sₙ 관계 함정',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: 'aₙ = Sₙ - Sₙ₋₁ (n≥2)와 a₁ = S₁을 별도로 확인하지 않아 n=1에서 오답.',
        solutionKey: [
          'Sₙ이 주어지면 aₙ = Sₙ - Sₙ₋₁ (n ≥ 2)',
          'a₁은 S₁과 같으므로 별도 계산',
          'n=1을 대입해서 a₁ = S₁ 확인',
        ],
        exampleSetup: 'Sₙ = 2n² - n일 때 a₁₀의 값',
      },
      {
        pattern: '점화식 풀이',
        difficulty: '최상',
        frequency: '자주출제',
        trapDescription: '복잡한 점화식에서 일반항 유도. 유형별 풀이법 숙지 필요.',
        solutionKey: [
          '특성방정식 이용 (aₙ₊₁ = paₙ + q 형)',
          '계차수열 이용 (aₙ₊₁ - aₙ = f(n) 형)',
          '양변 나누기 (aₙ₊₁ = paₙ + qⁿ 형)',
        ],
        exampleSetup: 'aₙ₊₁ = 2aₙ + 3, a₁ = 1일 때 일반항',
      },
    ],
  },
  // 수학II - 미분
  {
    unit: '미분',
    keywords: ['미분', '도함수', '극값', '접선', '변화율'],
    killerPatterns: [
      {
        pattern: '극값과 최대최소 혼동',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '극값(상대적 최대최소)과 최댓값/최솟값(절대적)을 구분하지 못하는 실수.',
        solutionKey: [
          '극값: f\'(x)=0이고 전후 부호 변화가 있는 점',
          '최댓값/최솟값: 극값과 정의역 끝점을 모두 비교',
          '닫힌 구간에서는 반드시 양 끝점 확인',
        ],
        exampleSetup: 'f(x) = x³ - 3x (−2 ≤ x ≤ 2)의 최댓값, 최솟값, 극값',
      },
      {
        pattern: '그래프 개형 추론',
        difficulty: '최상',
        frequency: '자주출제',
        trapDescription: 'f\'(x), f\'\'(x)의 부호로 f(x)의 증감, 오목/볼록을 종합하여 그래프 추론.',
        solutionKey: [
          'f\'(x) > 0: 증가, f\'(x) < 0: 감소',
          'f\'\'(x) > 0: 아래로 볼록, f\'\'(x) < 0: 위로 볼록',
          '변곡점: f\'\'(x) = 0이고 오목 방향 바뀌는 점',
        ],
        exampleSetup: 'f(x) = x⁴ - 4x³의 그래프 개형',
      },
    ],
  },
  // 수학II - 적분
  {
    unit: '적분',
    keywords: ['적분', '정적분', '넓이', '부피'],
    killerPatterns: [
      {
        pattern: '절댓값 적분',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '피적분함수에 절댓값이 있거나 음수 구간이 포함될 때 구간 분리 필요.',
        solutionKey: [
          '절댓값 내부 함수가 0이 되는 점 찾기',
          '구간을 나누어 각각 적분',
          '넓이 문제는 항상 절댓값(양수화) 필요',
        ],
        exampleSetup: '∫₋₂² |x² - 1| dx의 값',
      },
      {
        pattern: '정적분으로 정의된 함수',
        difficulty: '최상',
        frequency: '자주출제',
        trapDescription: '∫ₐˣ f(t)dt 꼴의 함수에서 미분과 적분 관계 활용.',
        solutionKey: [
          'F(x) = ∫ₐˣ f(t)dt이면 F\'(x) = f(x)',
          '상한이 g(x)이면 F\'(x) = f(g(x)) · g\'(x) (합성함수 미분)',
          '정적분 정의된 함수의 극값/최대최소 문제 주의',
        ],
        exampleSetup: 'f(x) = ∫₀ˣ (t² - 1)dt의 극솟값',
      },
    ],
  },
  // 확률과 통계
  {
    unit: '확률',
    keywords: ['확률', '조건부확률', '독립', '배반'],
    killerPatterns: [
      {
        pattern: '독립 vs 배반 혼동',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '독립(P(A∩B)=P(A)P(B))과 배반(A∩B=∅)의 개념을 혼동하는 실수.',
        solutionKey: [
          '독립: 한 사건이 다른 사건 확률에 영향 안 줌',
          '배반: 두 사건이 동시에 일어나지 않음',
          '배반이면 P(A∪B) = P(A) + P(B)',
          '독립이면 P(A∩B) = P(A) × P(B)',
        ],
        exampleSetup: '두 사건 A, B가 독립이고 P(A)=0.3, P(B)=0.4일 때 P(A∪B)',
      },
      {
        pattern: '조건부확률 역함정',
        difficulty: '최상',
        frequency: '자주출제',
        trapDescription: 'P(A|B)와 P(B|A)를 혼동하거나, 베이즈 정리 적용 실수.',
        solutionKey: [
          'P(A|B) = P(A∩B) / P(B): "B가 일어났을 때 A"',
          'P(B|A) = P(A∩B) / P(A): "A가 일어났을 때 B"',
          '베이즈: P(A|B) = P(B|A)P(A) / P(B)',
        ],
        exampleSetup: '불량품 검사 문제에서 "불량품일 때 A공장 제품일 확률"',
      },
    ],
  },
  // 기하 - 이차곡선
  {
    unit: '이차곡선',
    keywords: ['포물선', '타원', '쌍곡선', '초점', '준선'],
    killerPatterns: [
      {
        pattern: '이차곡선 정의 활용',
        difficulty: '최상',
        frequency: '자주출제',
        trapDescription: '공식 대입보다 정의(거리 관계)를 이용해야 풀리는 문제.',
        solutionKey: [
          '포물선: 초점까지 거리 = 준선까지 거리',
          '타원: 두 초점까지 거리의 합 = 2a (상수)',
          '쌍곡선: 두 초점까지 거리의 차 = 2a (상수)',
          '정의를 식으로 세우면 계산이 간단해짐',
        ],
        exampleSetup: '타원 위의 점 P에서 두 초점 F, F\'까지 거리의 합',
      },
      {
        pattern: '접선 공식 vs 판별식',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '이차곡선의 접선을 구할 때 공식 암기 vs 판별식 활용 선택.',
        solutionKey: [
          '곡선 위의 점이 주어지면: 접선 공식 직접 사용',
          '외부 점이 주어지면: 직선 y = mx + n 설정 → 연립 → D = 0',
          '접선 공식: 포물선 y² = 4px → yy₁ = 2p(x + x₁)',
        ],
        exampleSetup: '포물선 y² = 8x에 기울기가 2인 접선의 방정식',
      },
    ],
  },
  // 기하 - 벡터
  {
    unit: '벡터',
    keywords: ['벡터', '내적', '평면벡터', '공간벡터'],
    killerPatterns: [
      {
        pattern: '벡터 내적의 기하학적 해석',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '내적을 성분 계산만으로 구하면 각도 조건을 놓치는 경우.',
        solutionKey: [
          '내적 두 가지: a·b = |a||b|cosθ = a₁b₁ + a₂b₂',
          '수직 조건: a·b = 0',
          '사잇각 구하기: cosθ = (a·b) / (|a||b|)',
        ],
        exampleSetup: '|a| = 3, |b| = 4, a·b = 6일 때 두 벡터의 사잇각',
      },
      {
        pattern: '위치벡터와 내분/외분',
        difficulty: '상',
        frequency: '자주출제',
        trapDescription: '점의 위치를 벡터로 표현할 때 내분점/외분점 공식 적용 실수.',
        solutionKey: [
          '내분점: (na + mb) / (m + n) (m:n 내분)',
          '외분점: (-na + mb) / (m - n) (m:n 외분)',
          '무게중심: (a + b + c) / 3',
        ],
        exampleSetup: 'A(1, 2), B(4, 5)를 2:1로 내분하는 점의 위치벡터',
      },
    ],
  },
];

/**
 * 토픽에 해당하는 킬러 문항 유형 찾기
 */
export function findKillerPatterns(topic: string): KillerQuestionType | null {
  if (!topic) return null;

  const topicLower = topic.toLowerCase();

  for (const killerType of KILLER_QUESTION_TYPES) {
    for (const keyword of killerType.keywords) {
      if (topicLower.includes(keyword.toLowerCase()) || topic.includes(keyword)) {
        return killerType;
      }
    }
  }

  return null;
}

/**
 * 학년에 맞는 킬러 문항 유형 전체 조회
 */
export function getKillerPatternsByGrade(grade: string): KillerQuestionType[] {
  // 학년별 관련 단원 매핑
  const gradeUnits: Record<string, string[]> = {
    '고1': ['이차방정식과 이차함수', '도형의 방정식', '순열과 조합', '행렬'],
    '고2': ['지수와 로그', '삼각함수', '수열', '미분', '적분', '확률'],
    '고3': ['이차곡선', '벡터'],
  };

  const relevantUnits = gradeUnits[grade] || [];

  return KILLER_QUESTION_TYPES.filter(k =>
    relevantUnits.some(u => k.unit.includes(u) || u.includes(k.unit))
  );
}

// ============================================
// 수준별 추천 문제집 (2022 개정 교육과정)
// ============================================

export interface RecommendedBook {
  name: string;
  publisher: string;
  type: string;
  difficulty: 1 | 2 | 3 | 4 | 5;
  features: string;
  targetStudent: string;
}

export interface LevelBooks {
  level: '하위권' | '중위권' | '상위권';
  targetGrade: string;
  learningGoal: string;
  books: RecommendedBook[];
  recommendedCombos: {
    name: string;
    sequence: string[];
  }[];
}

export const RECOMMENDED_BOOKS: LevelBooks[] = [
  // 하위권
  {
    level: '하위권',
    targetGrade: '5등급 이하 → 3~4등급 목표',
    learningGoal: '기초 개념 확립, 자신감 회복, 기본 유형 숙달',
    books: [
      { name: '베이직쎈', publisher: '좋은책신사고', type: '기초유형', difficulty: 1, features: '쎈의 가장 쉬운 버전, A단계 집중', targetStudent: '기초가 전혀 없는 학생' },
      { name: '풍산자 개념완성', publisher: '지학사', type: '개념서', difficulty: 1, features: '개념을 가장 쉽게 설명, 주제별 정리', targetStudent: '수학 자신감이 낮은 학생' },
      { name: '개념+유형 개념편', publisher: '비상교육', type: '개념서', difficulty: 1, features: '기초 개념 이해와 유형 반복 학습', targetStudent: '개념 정리가 필요한 학생' },
      { name: '라이트쎈', publisher: '좋은책신사고', type: '기본유형', difficulty: 2, features: '쎈 C단계 생략, 부담 없는 분량', targetStudent: '기본 실력 강화 필요 학생' },
      { name: '체크체크', publisher: '천재교육', type: '개념서', difficulty: 1, features: '교과서 기반, 기초 문제 위주', targetStudent: '교과서 개념부터 다지는 학생' },
      { name: '빨리 이해하는 수학', publisher: '동아출판', type: '개념서', difficulty: 1, features: '짧은 설명, 빠른 개념 이해', targetStudent: '시간이 부족한 학생' },
      { name: '풍산자 반복수학', publisher: '지학사', type: '연산/유형', difficulty: 1, features: '같은 유형 반복으로 체화', targetStudent: '계산 실수가 많은 학생' },
      { name: '개념쎈', publisher: '좋은책신사고', type: '개념서', difficulty: 2, features: '개념 설명 + 기본 문제', targetStudent: '개념과 문제를 동시에 학습' },
      { name: '개념원리', publisher: '개념원리', type: '개념서', difficulty: 2, features: '가장 많이 사용되는 기본 개념서', targetStudent: '개념 학습의 표준 원하는 학생' },
      { name: '개념+유형 라이트', publisher: '비상교육', type: '기본유형', difficulty: 2, features: '기초 유형 문제 반복 연습', targetStudent: '유형 문제 첫 도전 학생' },
      { name: '우공비', publisher: '좋은책신사고', type: '개념서', difficulty: 2, features: '이미지로 개념 정리, 시각적 학습', targetStudent: '시각적 학습 선호 학생' },
      { name: '빨리 강해지는 수학', publisher: '동아출판', type: '기본유형', difficulty: 2, features: '핵심 유형만 선별 수록', targetStudent: '빠른 유형 파악 원하는 학생' },
      { name: '신 수학의 바이블', publisher: '이투스북', type: '개념서', difficulty: 2, features: '친절한 개념 설명, 단계별 구성', targetStudent: '혼자 공부하는 학생' },
      { name: '우공비Q 표준편', publisher: '좋은책신사고', type: '기본유형', difficulty: 2, features: '표준 난이도 유형 문제', targetStudent: '내신 70점대 목표 학생' },
      { name: 'EBS 수능특강', publisher: 'EBS', type: '개념+유형', difficulty: 2, features: '수능 연계, 기본 개념 정리', targetStudent: '수능 기초 다지는 학생' },
      { name: '마플교과서', publisher: '희망에듀', type: '개념서', difficulty: 2, features: '교과서 개념 + 빈출 유형', targetStudent: '내신 대비 개념 정리' },
      { name: '개념원리 RPM', publisher: '개념원리', type: '기본유형', difficulty: 2, features: '개념원리와 연계, 유형별 분류', targetStudent: '유형 연습 첫 문제집' },
      { name: '풍산자 필수유형', publisher: '지학사', type: '유형서', difficulty: 2, features: '출제 빈도 높은 문제만 선별', targetStudent: '효율적 학습 원하는 학생' },
      { name: '숨마쿰라우데 스타트업', publisher: '이룸이앤비', type: '기초개념', difficulty: 2, features: '개념부터 체계적 구성', targetStudent: '기초부터 탄탄히 쌓는 학생' },
      { name: '굿비', publisher: '이룸이앤비', type: '개념+유형', difficulty: 2, features: '9강으로 끝내는 구성, 부담 적음', targetStudent: '단기간 개념 정리 학생' },
    ],
    recommendedCombos: [
      { name: '기초 확립', sequence: ['풍산자 개념완성', '베이직쎈', '라이트쎈'] },
      { name: '개념 중심', sequence: ['개념원리', '개념원리 RPM'] },
    ],
  },
  // 중위권
  {
    level: '중위권',
    targetGrade: '3~4등급 → 2등급 안정화 목표',
    learningGoal: "개념의 '왜' 이해, 유형 숙달, 응용력 향상",
    books: [
      { name: '쎈', publisher: '좋은책신사고', type: '유형서', difficulty: 3, features: 'A/B/C 3단계, 1,500문제 이상', targetStudent: '모든 유형 연습이 필요한 학생' },
      { name: '개념원리 RPM', publisher: '개념원리', type: '유형서', difficulty: 2, features: '유형별 4개 이상 문제, 체계적 분류', targetStudent: '유형 연습 기본서 원하는 학생' },
      { name: '마플 시너지', publisher: '희망에듀', type: '유형서', difficulty: 3, features: '쎈의 1.5~2배 문제량, 양치기 최적화', targetStudent: '문제량으로 승부하는 학생' },
      { name: '개념+유형 파워편', publisher: '비상교육', type: '유형서', difficulty: 3, features: '응용 유형 중심, 단계별 학습', targetStudent: '응용 문제 연습 학생' },
      { name: '숨마쿰라우데', publisher: '이룸이앤비', type: '개념서', difficulty: 3, features: '깊은 개념 설명, 발전 예제 포함', targetStudent: '개념을 깊이 이해하려는 학생' },
      { name: '수학의 정석 기본편', publisher: '성지출판', type: '개념서', difficulty: 3, features: '전통의 명품 개념서', targetStudent: '체계적 개념 학습 원하는 학생' },
      { name: '수학의 바이블', publisher: '이투스북', type: '개념서', difficulty: 3, features: '일반 개념서보다 상세한 설명', targetStudent: '중간 단계 개념 보강 학생' },
      { name: '유형아작', publisher: '비상교육', type: '유형서', difficulty: 3, features: '유형별 집중 훈련', targetStudent: '취약 유형 집중 보완 학생' },
      { name: 'A급 원리해설', publisher: '디딤돌', type: '유형서', difficulty: 3, features: '원리 중심 해설, 사고력 강화', targetStudent: '왜 그런지 이해하려는 학생' },
      { name: '우공비Q 발전편', publisher: '좋은책신사고', type: '응용유형', difficulty: 3, features: '발전된 응용 문제 수록', targetStudent: '내신 80점대 목표 학생' },
      { name: '최상위 라이트', publisher: '디딤돌', type: '준심화', difficulty: 3, features: '심화 입문용, 부담 적은 난이도', targetStudent: '심화 문제 첫 도전 학생' },
      { name: '절대등급', publisher: '능률', type: '준심화', difficulty: 3, features: '내신 상위권 대비, 서술형 강화', targetStudent: '서술형 대비 필요 학생' },
      { name: '최고득점', publisher: '천재교육', type: '준심화', difficulty: 3, features: '고득점 목표 문제 수록', targetStudent: '90점대 목표 학생' },
      { name: '자이스토리', publisher: '수경출판', type: '기출문제', difficulty: 3, features: '모든 기출 수록, 연도별/유형별 정리', targetStudent: '기출 분석 원하는 학생' },
      { name: '마더텅 기출', publisher: '마더텅', type: '기출문제', difficulty: 3, features: '상세한 해설, 기출 총정리', targetStudent: '기출 중심 학습 학생' },
      { name: '1등급 만들기', publisher: '미래엔', type: '기출문제', difficulty: 3, features: '기출 분석 문제집, 483제', targetStudent: '내신 기출 대비 학생' },
      { name: '올백 1등급 MASTER', publisher: '천재교육', type: '고난도기출', difficulty: 3, features: '910제 고난도 기출', targetStudent: '1등급 도전 학생' },
      { name: '플래티넘', publisher: '사설', type: '내신기출', difficulty: 3, features: '학교별 내신 기출 모음', targetStudent: '학교 시험 유형 파악 학생' },
      { name: 'EBS 수능완성', publisher: 'EBS', type: '실전문제', difficulty: 3, features: '수능 연계, 실전 감각 훈련', targetStudent: '수능 대비 학생' },
      { name: '너기출', publisher: '사설', type: '기출문제', difficulty: 3, features: '선별된 기출, 가볍게 풀기 좋음', targetStudent: '핵심 기출만 원하는 학생' },
    ],
    recommendedCombos: [
      { name: '내신 집중', sequence: ['개념원리', '쎈(A~B단계)', '쎈(C단계)'] },
      { name: '양치기형', sequence: ['마플교과서', '마플 시너지', '자이스토리'] },
    ],
  },
  // 상위권
  {
    level: '상위권',
    targetGrade: '1~2등급 → 1등급 안정화/만점 목표',
    learningGoal: '킬러 문항 대비, 실수 제로, 복합 문제 해결력',
    books: [
      { name: '블랙라벨', publisher: '진학사', type: '심화서', difficulty: 4, features: '1등급 명품 문제집, 70~90p 얇은 구성', targetStudent: '킬러 문항 대비 학생' },
      { name: '일품', publisher: '좋은책신사고', type: '심화서', difficulty: 4, features: '쎈 C단계와 비슷하거나 약간 높음', targetStudent: '심화 입문 학생' },
      { name: '고쟁이', publisher: '이투스북', type: '심화서', difficulty: 4, features: '5개년 기출 분석, 최다빈출 문제', targetStudent: '내신 빈출 유형 집중 학생' },
      { name: '일등급 수학', publisher: '수경출판', type: '심화서', difficulty: 4, features: '사고력 요구 문제, 심화 입문용', targetStudent: '유형서→심화 전환 학생' },
      { name: '최상위', publisher: '디딤돌', type: '심화서', difficulty: 5, features: '증명 문제 많음, 적절한 힌트 제공', targetStudent: '수학적 사고력 확장 학생' },
      { name: '수학의 정석 실력편', publisher: '성지출판', type: '심화서', difficulty: 5, features: '수리논술 대비 수준, 사고 확장', targetStudent: '논술/최상위 대비 학생' },
      { name: '올림포스 고난도', publisher: '천재교육', type: '심화서', difficulty: 4, features: '내신 킬러 문항 집중', targetStudent: '학교 고난도 대비 학생' },
      { name: '수학의 고수', publisher: '능률', type: '심화서', difficulty: 4, features: '내신 고득점 심화 학습', targetStudent: '상위권 심화 학습 학생' },
      { name: '최고수준', publisher: '천재교육', type: '심화서', difficulty: 4, features: '최고 난이도 문제 수록', targetStudent: '만점 목표 학생' },
      { name: '에이급 수학', publisher: '에이급', type: '극심화', difficulty: 5, features: '경시대회 수준, 극고난도', targetStudent: '수학 올림피아드 대비 학생' },
      { name: '531 프로젝트', publisher: '이투스북', type: '심화서', difficulty: 4, features: '5지선다→3지선다→1답 구성', targetStudent: '킬러 문항 집중 훈련 학생' },
      { name: 'TOT', publisher: '사설', type: '심화서', difficulty: 4, features: 'Top of the Top, 최상위 문제', targetStudent: '1등급 확정 원하는 학생' },
      { name: '마플', publisher: '희망에듀', type: '기출문제', difficulty: 4, features: '고난도 기출 + 변형 문제', targetStudent: '기출 심화 학습 학생' },
      { name: '킬링캠프', publisher: '사설', type: '실전대비', difficulty: 5, features: '수능 직전 마무리, 고난도 집중', targetStudent: '수능 직전 마무리 학생' },
      { name: '일타에듀 고난도 모의고사', publisher: '사설', type: '실전대비', difficulty: 5, features: '킬러 문제 깊이 있는 접근', targetStudent: '수능 실전 감각 훈련 학생' },
      { name: '뉴런', publisher: '사설', type: '심화서', difficulty: 4, features: '신경망처럼 연결된 개념 학습', targetStudent: '개념 연결성 강화 학생' },
      { name: '프로메쓰', publisher: '사설', type: '내신기출', difficulty: 4, features: '고등학교 내신 기출 분석', targetStudent: '학교별 기출 대비 학생' },
      { name: '수학대왕', publisher: '사설', type: 'AI학습', difficulty: 3, features: 'AI 실력 분석, 맞춤 문제 제공', targetStudent: '취약점 파악 원하는 학생' },
      { name: 'EBS 수능특강 변형문제', publisher: '사설', type: '변형문제', difficulty: 4, features: 'EBS 연계 변형, 실전 감각', targetStudent: '수능특강 심화 학습 학생' },
      { name: '학교별 기출문제', publisher: '족보닷컴 등', type: '내신기출', difficulty: 4, features: '학교 시험 유형 파악', targetStudent: '학교 시험 유형 파악 학생' },
    ],
    recommendedCombos: [
      { name: '내신 1등급', sequence: ['쎈(C단계)', '고쟁이', '블랙라벨', '올림포스 고난도'] },
      { name: '만점 도전', sequence: ['일등급 수학', '블랙라벨', '최상위', '학교 기출'] },
    ],
  },
];

/**
 * 수준에 맞는 추천 문제집 목록 조회
 */
export function getBooksByLevel(level: '하위권' | '중위권' | '상위권'): LevelBooks | null {
  return RECOMMENDED_BOOKS.find(lb => lb.level === level) || null;
}

/**
 * 난이도 비교 정보
 */
export const DIFFICULTY_COMPARISON = {
  description: '심화서 기준 난이도 비교',
  sequence: [
    { name: '일품', level: '심화 입문' },
    { name: '일등급 수학', level: '심화 기본' },
    { name: '고쟁이', level: '심화 기본' },
    { name: '블랙라벨', level: '심화 표준' },
    { name: '최상위', level: '심화 고급' },
    { name: '수학의 정석 실력편', level: '최상위' },
    { name: '에이급', level: '경시대회 수준' },
  ],
};

/**
 * 교재 선택 가이드
 */
export const BOOK_SELECTION_GUIDE = {
  하위권: {
    structure: '개념서 1권 + 기본 유형서 1권',
    principle: "여러 권 대충 풀기보다 '1권 완벽히' 마스터",
    example: '풍산자 + 라이트쎈 또는 개념원리 + RPM',
  },
  중위권: {
    structure: '개념서 1권 + 유형서 1~2권',
    principle: '쎈 A~B단계 완벽 후 C단계 도전',
    example: '개념원리 + 쎈 + 자이스토리(기출)',
  },
  상위권: {
    structure: '유형서 1권 + 심화서 1~2권 + 기출',
    principle: '고쟁이, 블랙라벨, 올림포스 고난도 중 2권 이상',
    example: '쎈(C단계) + 고쟁이 + 블랙라벨 + 학교기출',
  },
};

/**
 * 교재 선택 주의사항
 */
export const BOOK_CAUTIONS = [
  '2022 개정 교육과정 적용 여부 확인 (2025년 고1부터)',
  '너무 어려운 문제집은 자신감 하락 유발',
  '문제집 선택 후 최소 2회독 권장',
  '오답노트 병행 필수',
];

// ============================================
// 수준별 격려 멘트
// ============================================

export interface EncouragementMessages {
  level: '하위권' | '중위권' | '상위권' | '공통';
  messages: string[];
}

export const ENCOURAGEMENT_MESSAGES: EncouragementMessages[] = [
  {
    level: '하위권',
    messages: [
      '수학은 계단입니다. 한 칸씩 차근차근 오르면 반드시 정상에 도착합니다.',
      '지금 기초를 다지는 시간이 고등학교 3년을 결정합니다. 조급해하지 마세요.',
      '어설픈 선행보다 확실한 복습이 100배 효과적입니다.',
      '수학을 못하는 게 아니라, 아직 제대로 배우지 않은 것뿐입니다.',
      '중학교 개념만 확실히 잡아도 고등학교 수학의 절반은 해결됩니다.',
      '오늘 틀린 문제가 내일의 실력이 됩니다. 틀려도 괜찮아요.',
      '1등급 학생도 처음엔 기초부터 시작했습니다.',
      '포기하지 않는 것, 그것이 이미 절반의 성공입니다.',
      '쉬운 문제를 확실히 맞히는 것이 어려운 문제를 푸는 것보다 중요합니다.',
      '비교하지 마세요. 어제의 나보다 오늘의 내가 성장하면 됩니다.',
      "수학 자신감은 '할 수 있다'는 경험에서 옵니다. 작은 성공부터 쌓아가세요.",
      '개념을 이해하는 데 시간이 걸리는 건 당연한 일입니다. 천천히 가도 괜찮아요.',
      '문제집 여러 권을 대충 푸는 것보다, 한 권을 완벽히 마스터하세요.',
      "수학은 암기가 아니라 이해입니다. '왜?'라고 질문하는 습관을 들이세요.",
      '기초가 탄탄하면 응용은 자연스럽게 따라옵니다.',
      '지금 힘들어도 포기하지 않으면, 6개월 후 놀라운 변화를 경험할 거예요.',
      '수학 점수는 노력한 만큼 정직하게 오릅니다. 믿고 꾸준히 하세요.',
      '모르는 건 부끄러운 게 아닙니다. 모르는 척하는 게 부끄러운 겁니다.',
      '작은 성취가 모여 큰 자신감이 됩니다. 오늘 한 문제라도 제대로 이해하세요.',
      '수학을 싫어하는 게 아니라, 못한다고 생각해서 싫어하는 겁니다. 할 수 있어요!',
    ],
  },
  {
    level: '중위권',
    messages: [
      "중위권에서 상위권으로 가는 열쇠는 '개념의 왜'를 이해하는 것입니다.",
      "3등급과 1등급의 차이는 실력이 아니라 '디테일'입니다.",
      '지금 위치가 정체가 아니라 도약의 준비 단계입니다.',
      '같은 유형을 세 번 틀리면 개념으로 돌아가세요. 그것이 지름길입니다.',
      '꾸준함이 천재를 이깁니다. 매일 2시간씩 3개월이면 1등급도 가능합니다.',
      '공식을 외우지 말고, 공식이 왜 그렇게 되는지 이해하세요.',
      "오답노트는 쓰는 게 아니라 '보는 것'입니다. 시험 전 반드시 복습하세요.",
      "중위권의 가장 큰 적은 '대충 아는 것'입니다. 확실히 알거나, 모른다고 인정하세요.",
      '시험에서 아는 문제를 틀리는 것이 가장 아까운 실수입니다.',
      '기출문제는 출제자의 의도를 읽는 훈련입니다. 반드시 분석하세요.',
      '2등급에서 1등급으로 가는 데 필요한 건 5~10점, 충분히 가능한 목표입니다.',
      '실수는 실력입니다. 실수를 줄이는 것도 훈련이 필요합니다.',
      '문제를 많이 푸는 것보다, 틀린 문제를 제대로 분석하는 것이 중요합니다.',
      '수학은 스포츠와 같습니다. 매일 훈련해야 실력이 유지됩니다.',
      '지금 노력하면 내신과 수능, 두 마리 토끼를 다 잡을 수 있습니다.',
      '모의고사 성적에 일희일비하지 마세요. 추세가 중요합니다.',
      '어려운 문제를 고민하는 시간이 실력을 키웁니다. 바로 답을 보지 마세요.',
      '학교 선생님의 수업과 프린트가 내신의 80%입니다. 수업에 집중하세요.',
      '중위권은 가능성의 구간입니다. 어떻게 하느냐에 따라 1등급도, 4등급도 갈 수 있어요.',
      '지금 흘리는 땀이 시험장에서 여유가 됩니다. 오늘도 화이팅!',
    ],
  },
  {
    level: '상위권',
    messages: [
      "1등급 유지의 비결은 '아는 문제를 절대 틀리지 않는 것'입니다.",
      "상위권의 경쟁은 실력이 아니라 '컨디션 관리'입니다.",
      "만점과 98점의 차이는 실력이 아니라 '집중력'입니다.",
      '킬러 문항은 두 개 이상의 개념이 결합된 문제입니다. 개념 연결 훈련을 하세요.',
      '실수 노트를 만들어 자신만의 실수 패턴을 파악하세요.',
      '쉬운 문제에서 방심하는 순간, 등급이 바뀝니다.',
      '시험 시간의 마지막 10분 검토가 등급을 결정합니다.',
      '상위권일수록 기본으로 돌아가는 훈련이 필요합니다.',
      '1등급은 목표가 아니라 시작점입니다. 만점에 도전하세요.',
      "고난도 문제를 풀 때는 '왜 이 문제가 어려운가'를 분석하세요.",
      "서술형에서 감점되는 이유의 80%는 '과정 생략'입니다.",
      '실전처럼 연습하고, 연습처럼 실전에 임하세요.',
      '1점 차이로 등급이 갈릴 수 있습니다. 한 문제도 포기하지 마세요.',
      '자만은 실력의 적입니다. 항상 겸손하게 복습하세요.',
      '상위권의 슬럼프는 성장통입니다. 곧 더 높이 올라갈 거예요.',
      '기출 변형 문제를 많이 풀수록 시험장에서 당황하지 않습니다.',
      "계산 실수를 줄이는 가장 좋은 방법은 '천천히 정확하게' 푸는 습관입니다.",
      "문제를 풀고 나서 '다른 풀이는 없을까?' 고민하는 것이 실력을 키웁니다.",
      '1등급을 받는 것보다 1등급을 유지하는 것이 더 어렵습니다. 긴장을 놓지 마세요.',
      '지금의 노력이 대학뿐 아니라 평생의 사고력이 됩니다. 끝까지 최선을 다하세요!',
    ],
  },
  {
    level: '공통',
    messages: [
      '수학은 혼자 고민하는 시간이 실력이 됩니다.',
      '결과보다 과정을 칭찬해주세요. 노력하는 습관이 평생 갑니다.',
      '오늘 하루 최선을 다했다면, 그것으로 충분합니다.',
      '수학 성적은 거짓말을 하지 않습니다. 노력한 만큼 오릅니다.',
      '좋은 컨디션이 좋은 성적의 시작입니다. 충분히 자고 건강하게 공부하세요.',
      '선생님과 부모님은 항상 응원하고 있습니다. 힘내세요!',
      '한 문제를 제대로 이해하는 것이 열 문제를 대충 푸는 것보다 낫습니다.',
      '수학 공부에 왕도는 없지만, 정도(正道)는 있습니다. 꾸준함이 답입니다.',
      '시험은 끝이 아니라 다음 단계를 위한 점검입니다.',
      '함께 하면 더 멀리 갈 수 있습니다. 언제든 질문하세요!',
    ],
  },
];

/**
 * 수준별 격려 멘트 가져오기 (랜덤 1~2개)
 * @param level 학생 수준
 * @param count 가져올 멘트 개수 (기본 1개)
 * @param includeCommon 공통 멘트 포함 여부 (기본 true)
 */
export function getEncouragementMessages(
  level: '하위권' | '중위권' | '상위권',
  count: number = 1,
  includeCommon: boolean = true
): string[] {
  const levelMessages = ENCOURAGEMENT_MESSAGES.find(e => e.level === level)?.messages || [];
  const commonMessages = includeCommon
    ? ENCOURAGEMENT_MESSAGES.find(e => e.level === '공통')?.messages || []
    : [];

  const allMessages = [...levelMessages, ...commonMessages];

  // 랜덤 셔플 후 count개 선택
  const shuffled = allMessages.sort(() => Math.random() - 0.5);
  return shuffled.slice(0, Math.min(count, shuffled.length));
}

/**
 * 학년 기반 멘트 필터링 (중학생/고등학생 맞춤)
 * @param messages 원본 멘트 배열
 * @param grade 학년 (예: '중1', '고2')
 */
export function filterMessagesByGrade(messages: string[], grade: string): string[] {
  const isMiddleSchool = grade.startsWith('중');
  const isHighSchool = grade.startsWith('고');

  return messages.map(msg => {
    // 고등학교 관련 멘트를 중학생에게 맞게 수정
    if (isMiddleSchool) {
      return msg
        .replace(/고등학교 3년/g, '중고등학교 시절')
        .replace(/고등학교 수학/g, '고등학교 진학 후 수학')
        .replace(/대학/g, '고등학교')
        .replace(/수능/g, '고입/내신');
    }
    return msg;
  });
}

/**
 * 시험 결과 기반 수준 추정
 * @param correctRate 정답률 (0~100)
 */
export function estimateLevel(correctRate: number): '하위권' | '중위권' | '상위권' {
  if (correctRate >= 80) return '상위권';
  if (correctRate >= 50) return '중위권';
  return '하위권';
}
